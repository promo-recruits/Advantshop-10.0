; (function (ng) {
    'use strict';

    var ModalRussianPostCustomsDeclarationProductDataCtrl = function ($uibModalInstance, uiGridCustomConfig) {
        var ctrl = this;
        ctrl.gridInited = false;
        ctrl.countriesCodes = {
            '895': 'Абхазия',
            '36': 'Австралия',
            '40': 'Австрия',
            '31': 'Азербайджан',
            '8': 'Албания',
            '12': 'Алжир',
            '660': 'Ангилья',
            '24': 'Ангола',
            '20': 'Андорра',
            '10': 'Антарктика',
            '28': 'Антигуа и барбуда',
            '32': 'Аргентина',
            '51': 'Армения',
            '533': 'Аруба',
            '4': 'Афганистан',
            '44': 'Багамы',
            '50': 'Бангладеш',
            '52': 'Барбадос',
            '48': 'Бахрейн',
            '112': 'Беларусь',
            '84': 'Белиз',
            '56': 'Бельгия',
            '204': 'Бенин',
            '60': 'Бермуды',
            '100': 'Болгария',
            '68': 'Боливия',
            '535': 'Бонэйр, синт-эстатиус и саба',
            '70': 'Босния и герцеговина',
            '72': 'Ботсвана',
            '76': 'Бразилия',
            '92': 'Британские виргинские острова',
            '86': 'Британские территории в индийском океане',
            '96': 'Бруней',
            '74': 'Буве острова',
            '854': 'Буркина-фасо',
            '108': 'Бурунди',
            '64': 'Бутан',
            '548': 'Вануату',
            '336': 'Ватикан',
            '826': 'Великобритания',
            '348': 'Венгрия',
            '862': 'Венесуэла боливарианская республика',
            '850': 'Виргинские острова (сша)',
            '16': 'Восточное самоа',
            '704': 'Вьетнам',
            '266': 'Габон',
            '332': 'Гаити',
            '328': 'Гайана',
            '270': 'Гамбия',
            '288': 'Гана',
            '312': 'Гваделупа',
            '320': 'Гватемала',
            '324': 'Гвинея',
            '624': 'Гвинея-бисау',
            '276': 'Германия',
            '831': 'Гернси',
            '292': 'Гибралтар',
            '340': 'Гондурас',
            '344': 'Гонконг',
            '308': 'Гренада',
            '304': 'Гренландия',
            '300': 'Греция',
            '268': 'Грузия',
            '316': 'Гуам',
            '208': 'Дания',
            '180': 'Демократическая республика конго',
            '832': 'Джерси',
            '262': 'Джибути',
            '212': 'Доминика',
            '214': 'Доминиканская республика',
            '818': 'Египет',
            '894': 'Замбия',
            '732': 'Западная сахара',
            '716': 'Зимбабве',
            '376': 'Израиль',
            '356': 'Индия',
            '360': 'Индонезия',
            '400': 'Иордания',
            '368': 'Ирак',
            '364': 'Иран',
            '372': 'Ирландия',
            '352': 'Исландия',
            '724': 'Испания',
            '380': 'Италия',
            '887': 'Йемен',
            '132': 'Кабо-верде',
            '398': 'Казахстан',
            '136': 'Каймановы острова',
            '116': 'Камбоджа',
            '120': 'Камерун',
            '124': 'Канада',
            '634': 'Катар',
            '404': 'Кения',
            '196': 'Кипр',
            '417': 'Киргизия',
            '296': 'Кирибати',
            '156': 'Китай',
            '408': 'Кндр',
            '166': 'Кокос острова',
            '170': 'Колумбия',
            '174': 'Коморы',
            '410': 'Корея',
            '914': 'Косово',
            '188': 'Коста-рика',
            '384': 'Кот-д\'ивуар',
            '192': 'Куба',
            '414': 'Кувейт',
            '184': 'Кука острова',
            '531': 'Кюрасао',
            '418': 'Лаос',
            '428': 'Латвия',
            '426': 'Лесото',
            '430': 'Либерия',
            '422': 'Ливан',
            '434': 'Ливия',
            '440': 'Литва',
            '438': 'Лихтенштейн',
            '442': 'Люксембург',
            '480': 'Маврикий',
            '478': 'Мавритания',
            '450': 'Мадагаскар',
            '175': 'Майотта',
            '446': 'Макао',
            '807': 'Македония',
            '454': 'Малави',
            '458': 'Малайзия',
            '466': 'Мали',
            '581': 'Малые тихоокеанские отдаленные острова соединенных штатов',
            '462': 'Мальдивы',
            '470': 'Мальта',
            '504': 'Марокко',
            '474': 'Мартиника',
            '584': 'Маршалловы острова',
            '484': 'Мексика',
            '583': 'Микронезия',
            '508': 'Мозамбик',
            '498': 'Молдова, республика',
            '492': 'Монако',
            '496': 'Монголия',
            '500': 'Монтсеррат',
            '104': 'Мьянма',
            '833': 'Мэн остров',
            '516': 'Намибия',
            '520': 'Науру',
            '524': 'Непал',
            '562': 'Нигер',
            '566': 'Нигерия',
            '530': 'Нидерландские антилы',
            '528': 'Нидерланды',
            '558': 'Никарагуа',
            '570': 'Ниуэ',
            '554': 'Новая зеландия',
            '540': 'Новая каледония',
            '578': 'Норвегия',
            '574': 'Норфолк остров',
            '784': 'Объединенные арабские эмираты',
            '512': 'Оман',
            '586': 'Пакистан',
            '585': 'Палау',
            '275': 'Палестина',
            '591': 'Панама',
            '598': 'Папуа новая гвинея',
            '600': 'Парагвай',
            '604': 'Перу',
            '612': 'Питкерн',
            '616': 'Польша',
            '620': 'Португалия',
            '630': 'Пуэрто-рико',
            '178': 'Республика конго',
            '638': 'Реюньон',
            '162': 'Рождества остров',
            '643': 'Российская федерация',
            '646': 'Руанда',
            '642': 'Румыния',
            '222': 'Сальвадор',
            '882': 'Самоа',
            '674': 'Сан-марино',
            '678': 'Сан-томе и принсипи',
            '682': 'Саудовская аравия',
            '748': 'Свазиленд',
            '654': 'Святая елена, остров вознесения, тристан-да-кунья',
            '580': 'Северные марианские острова',
            '690': 'Сейшелы',
            '652': 'Сен-бартелеми',
            '686': 'Сенегал',
            '663': 'Сен-мартен (французская часть)',
            '666': 'Сен-пьер и микелон',
            '670': 'Сент-винсент и гренадины',
            '659': 'Сент-киттс и невис',
            '662': 'Сент-люсия',
            '534': 'Сент-мартен (нидерландская часть)',
            '688': 'Сербия',
            '702': 'Сингапур',
            '760': 'Сирийская арабская республика',
            '703': 'Словакия',
            '705': 'Словения',
            '840': 'Соединенные штаты америки',
            '90': 'Соломоновы острова',
            '706': 'Сомали',
            '729': 'Судан',
            '740': 'Суринам',
            '694': 'Сьерра-леоне',
            '762': 'Таджикистан',
            '764': 'Таиланд',
            '158': 'Тайвань',
            '834': 'Танзания',
            '796': 'Теркс и кайкос острова',
            '626': 'Тимор-лесте',
            '768': 'Того',
            '772': 'Токелау',
            '776': 'Тонга',
            '780': 'Тринидад и тобаго',
            '798': 'Тувалу',
            '788': 'Тунис',
            '795': 'Туркмения',
            '792': 'Турция',
            '800': 'Уганда',
            '860': 'Узбекистан',
            '804': 'Украина',
            '876': 'Уоллeс и футуна острова',
            '858': 'Уругвай',
            '234': 'Фарерские острова',
            '242': 'Фиджи',
            '608': 'Филиппины',
            '246': 'Финляндия',
            '238': 'Фолклендские (мальвинские) острова',
            '250': 'Франция',
            '249': 'Франция, метрополия',
            '254': 'Французская гвиана',
            '258': 'Французская полинезия',
            '260': 'Французские южные территории',
            '334': 'Херд и макдональд острова',
            '191': 'Хорватия',
            '140': 'Центрально-африканская республика',
            '148': 'Чад',
            '499': 'Черногория',
            '203': 'Чешская республика',
            '152': 'Чили',
            '903': 'Чили, пасхи остров',
            '756': 'Швейцария',
            '752': 'Швеция',
            '744': 'Шпицберген и ян-майен',
            '144': 'Шри ланка',
            '218': 'Эквадор',
            '226': 'Экваториальная гвинея',
            '248': 'Эландские острова',
            '232': 'Эритрея',
            '233': 'Эстония',
            '231': 'Эфиопия',
            '239': 'Южная джорджия и южные сандвичевы острова',
            '896': 'Южная осетия',
            '710': 'Южно-африканская республика',
            '728': 'Южный судан',
            '388': 'Ямайка',
            '392': 'Япония',
        };

        ctrl.gridOptions = ng.extend({}, uiGridCustomConfig, {
            columnDefs: [
                {
                    name: 'Name',
                    displayName: 'Название',
                    cellTemplate:
                        '<div class="ui-grid-cell-contents ui-grid-cell-contents-order-items">' +
                        '<div>' +
                        '<div>{{row.entity.Name}}</div> ' +
                        '<div class="order-item-artno">' + 'Артикул:' + '{{row.entity.ArtNo}}</div> ' +
                        '</div>' +
                        '</div>',
                    enableCellEdit: true,
                    enableSorting: false,
                },
                {
                    name: 'CountryCode',
                    displayName: 'Страна происхождения',
                    cellTemplate: '<div class="ui-grid-cell-contents"><div ng-bind="grid.appScope.$ctrl.gridExtendCtrl.getCountryName(COL_FIELD)"></div></div>',
                    enableCellEdit: true,
                    enableSorting: false,
                    type: 'select',
                    minWidth: 200,
                    uiGridCustomEdit: {
                        customViewValue: 'countryCodeViewValue',
                        onInit: function (rowEntity, colDef, newValue, uiGridEditCustom) {
                            uiGridEditCustom.countryCodeViewValue = ctrl.countriesCodes[rowEntity[colDef.name]] || '----';
                        },
                        onChange: function (rowEntity, colDef, newValue, uiGridEditCustom) {
                            uiGridEditCustom.countryCodeViewValue = ctrl.countriesCodes[newValue];
                        },
                        replaceNullable: false,
                        editDropdownOptionsArray: [{ label: '----', value: '' }].concat(
                            Object.keys(ctrl.countriesCodes)
                                .sort(function (a, b) { return ctrl.countriesCodes[a] < ctrl.countriesCodes[b] ? -1 : 1; })
                                .map(function (countrycode) {
                                    return { label: ctrl.countriesCodes[countrycode], value: countrycode };
                        }))
                    }
                },
                {
                    name: 'TnvedCode',
                    displayName: 'Код ТНВЭД',
                    enableCellEdit: true,
                    enableSorting: false,
                    width: 200,
                },
            ]
        });

        ctrl.$onInit = function () {
            var params = ctrl.$resolve.params;
            ctrl.products = params.products;
            ctrl.gridOptions.data = ctrl.products;
        };

        ctrl.getCountryName = function (countryCode) {
            return ctrl.countriesCodes[countryCode] || '----';
        };

        ctrl.gridOnInit = function (grid) {
            ctrl.grid = grid;
            ctrl.gridInited = true;
        };

        ctrl.close = function () {
            $uibModalInstance.dismiss('cancel');
        };

        ctrl.save = function () {
            $uibModalInstance.close({ products: ctrl.products });
        };
    };

    ModalRussianPostCustomsDeclarationProductDataCtrl.$inject = ['$uibModalInstance', 'uiGridCustomConfig'];

    ng.module('uiModal')
        .controller('ModalRussianPostCustomsDeclarationProductDataCtrl', ModalRussianPostCustomsDeclarationProductDataCtrl);

})(window.angular);