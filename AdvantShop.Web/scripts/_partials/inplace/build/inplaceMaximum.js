!function(){"use strict";window.angular.module("inplace",[]).constant("inplaceRichConfig",{title:!1,allowedContent:!0,autoParagraph:!1,removePlugins:"dragdrop, basket",floatSpaceDockedOffsetY:5,toolbar:[{name:"source",items:["Sourcedialog","Templates"]},{name:"elements",items:["NumberedList","BulletedList","Link","Unlink","-","Image","Flash","Table","HorizontalRule"]},{name:"styles",items:["Styles","Font","FontSize","lineheight"]},"/",{name:"text",items:["Bold","Italic","Underline","Strike","Subscript","RemoveFormat"]},{name:"text",items:["TextColor","BGColor"]},{name:"align",items:["Outdent","Indent","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"document",items:["PasteFromWord","Undo","Redo","Scayt"]},{name:"icons",items:["Emojione"]}],extraPlugins:"scriptencode,sourcedialog,codemirror,lineheight,bold,emojione,fontSizeExtend",codemirror:{},stylesSet:"inplaceStyles"})}(),function(s){"use strict";s.module("inplace").directive("inplaceStart",["$window","$compile","$rootScope","inplaceService",function(o,r,e,u){return{restrict:"A",scope:{},link:function(i,e,t,n){var a="[data-inplace-rich], [data-inplace-modal], [data-inplace-image], [data-inplace-autocomplete], [data-inplace-properties-new], [data-inplace-price], [data-inplace-price-panel], [data-inplace-switch]",l=o.matchMedia("(min-width: 64em)");function c(){var e=document.querySelectorAll(a);null!=e&&0<e.length&&Array.prototype.slice.call(e).forEach(function(e){var t=s.element(e),n=t.scope()||i;t.addClass("inplace-initialized"),r(e)(n.$new())})}l.matches&&c(),l.addListener(function(e){e.matches?c():function(){u.destroyAll();var e=document.querySelectorAll(a);null!=e&&0<e.length&&Array.prototype.slice.call(e).forEach(function(e){s.element(e).removeClass("inplace-initialized")})}()})}}}]),s.module("inplace").directive("inplaceSwitch",[function(e){return{restrict:"A",scope:!0,controller:"InplaceSwitchCtrl",controllerAs:"inplaceSwitch",bindToController:!0}}]),s.module("inplace").directive("inplaceProgress",function(){return{restrict:"A",scope:{},controller:"InplaceProgressCtrl",controllerAs:"inplaceProgress",bindToController:!0,replace:!0,template:'<div class="inplace-progress icon-spinner-before icon-animate-spin-before" data-ng-if="inplaceProgress.state.show === true"></div>'}})}(window.angular),function(I){"use strict";var p=0,d=0,b=0,v=0;"undefined"!=typeof CKEDITOR&&null!=CKEDITOR&&!0===CKEDITOR.env.isCompatible&&(CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name,n=e.data.definition;if("table"==t){var i=n.getContents("info");i.get("txtWidth").default=null,i.get("txtBorder").default=null,i.get("txtCellPad").default=null,i.get("txtCellSpace").default=null}}),I.module("inplace").directive("inplaceRich",["$compile","$document","$locale","$timeout","$window","inplaceService","inplaceRichConfig",function(c,o,e,r,t,u,s){return{restrict:"A",scope:{inplaceRich:"&",inplaceUrl:"@",inplaceOnSave:"&"},controller:"InplaceRichCtrl",controllerAs:"inplaceRich",bindToController:!0,link:function(t,i,n,a){a.getParams=function(){return new Function("return "+i.attr("data-inplace-params"))()||{}};var l=I.extend(I.copy(s),window._LandingCKeditorConfig||{},a.inplaceRich()||{},{language:"ru-ru"===e.id?"ru":"uk-ua"===e.id?"ua":"en"});r(function(){var e;null==n.id&&(n.$set("id","inplaceRich_"+p),p+=1),!0===l.editorSimple&&(l.removePlugins="showborders, magicline",l.enterMode=CKEDITOR.ENTER_BR,l.forcePasteAsPlainText=!0,i.addClass("inplace-rich-simple")),i.find("script").removeAttr("type"),0===i.html().trim().length&&null!=n.placeholder&&(i.addClass("inplace-rich-empty"),i.text(n.placeholder)),a.initCKeditor=function(){i[0].removeEventListener("mouseover",e),i.attr("contenteditable","true"),a.editor=CKEDITOR.inline(n.id,l),null!=a.editor&&(a.editor.on("instanceReady",function(e){!0===l.editorSimple&&(o[0].getElementById(e.editor.id+"_top").style.display="none")}),a.editor.on("focus",function(e){a.editor.getData().trim()===n.placeholder&&(i.removeClass("inplace-rich-empty"),a.editor.setData("")),t.$apply(function(){var e;a.active(),null==a.buttonsRendered||!1===a.buttonsRendered?(e=I.element('<div inplace-rich-buttons="'+n.id+'" is-show="inplaceRich.isShow" data-on-init="inplaceRich.addCallback(callback)"></div>'),document.body.appendChild(e[0]),c(e)(t),a.buttonsRendered=!0):e=a.buttons.element,a.callCallbacks(a.callbacks)})}),a.editor.on("blur",function(e){setTimeout(function(){t.$apply(function(){(a.isShow=!1)!==a.clickedButtons&&null!=a.clickedButtons||a.save(),a.clickedButtons=!1,0===a.editor.getData().trim().length&&null!=n.placeholder&&(i.addClass("inplace-rich-empty"),a.editor.setData(n.placeholder))})},100)}),a.editor.on("key",function(e){switch(e.data.keyCode){case 13:if(!0===l.editorSimple){var t=document.createElement("input"),n=i[0].getBoundingClientRect();t.className="inplace-input-fake",t.style.top=n.top+"px",t.style.left=n.left+"px",document.body.appendChild(t),t.focus(),setTimeout(function(){t.parentNode.removeChild(t)},100),e.stop(),e.cancel()}}}))},e=a.initCKeditor,i[0].addEventListener("mouseover",e),i.addClass("inplace-initialized"),u.addRich(n.id,a,i[0])})}}}]),I.module("inplace").directive("inplaceRichButtons",function(){return{restrict:"A",scope:{inplaceRichButtons:"@",isShow:"<?",onInit:"&"},controller:"InplaceRichButtonsCtrl",controllerAs:"inplaceRichButtons",bindToController:!0,replace:!0,templateUrl:"/scripts/_partials/inplace/templates/richButtons.html"}}),I.module("inplace").directive("inplacePrice",["$compile","$document","$locale","$window","inplaceService","productService","domService","$timeout",function(p,d,m,e,f,n,g,t){return{restrict:"A",scope:{inplaceParams:"&",inplaceUrl:"@"},controller:"InplacePriceCtrl",controllerAs:"inplacePrice",bindToController:!0,link:function(o,r,e,u){var s,t;u.product=n.getProduct(),r[0].classList.add("inplace-price-container"),r[0].classList.add("inplace-offset"),t=function(e){var t,n=g.closest(e.target,".price-current"),i=g.closest(e.target,".price-unknow"),a=g.closest(e.target,".price-old"),l=g.closest(e.target,".price-discount-percent"),c={language:"ru-ru"===m.id?"ru":"uk-ua"===m.id?"ua":"en"};null!=n?(t=n,u.type="price"):null!=i?(t=i,u.type="price"):null!=a?(t=a,u.type="price"):null!=l&&(t=l,u.type="discountPercent"),null==t||!1===u.needReinit[u.type]&&null!=s||(u.needReinit[u.type]=!0,null!=(s=t.querySelector(".price-number")||i||l)&&(null!=s.id&&0!==s.id.length||(s.id="inplacePrice_"+v,v+=1),null==CKEDITOR.instances[s.id]&&(c.removePlugins=" showborders, magicline",c.enterMode=CKEDITOR.ENTER_BR,c.forcePasteAsPlainText=!0,s.classList.add("inplace-rich-simple"),s.setAttribute("contenteditable","true"),u.editor=CKEDITOR.inline(s.id,c),u.editor.on("instanceReady",function(e){d[0].getElementById(e.editor.id+"_top").style.display="none"}),u.editor.on("focus",function(e){!0===s.classList.contains("price-unknown")&&null==u.convertToFloat(u.editor.getData({format:"text"}))&&u.editor.setData("0"),o.$apply(function(){var e,t;u.active(),null==u.buttonsRendered||!1===u.buttonsRendered?(e=I.element('<div data-inplace-price-buttons="'+s.id+'" data-on-init="inplacePrice.addCallback(callback)"></div>'),document.body.appendChild(e[0]),p(e)(o),t=I.element('<div data-inplace-price-panel="'+s.id+'" data-on-init="inplacePrice.addCallback(callback)"></div>'),document.body.appendChild(t[0]),p(t)(o),u.buttonsRendered=!0):(e=u.buttons.element,t=u.panel.element),u.callCallbacks(u.callbacks)})}),u.editor.on("blur",function(e){setTimeout(function(){o.$apply(function(){(u.isShow=!1)!==u.clickedButtons&&null!=u.clickedButtons||u.save(),u.clickedButtons=!1})},100)}),u.editor.on("key",function(e){if(13===e.data.keyCode){var t=document.createElement("input"),n=r[0].getBoundingClientRect();t.className="inplace-input-fake",t.style.top=n.top+"px",t.style.left=n.left+"px",document.body.appendChild(t),t.focus(),setTimeout(function(){t.parentNode.removeChild(t)},100),e.stop(),e.cancel()}else{null===u.convertToFloat(u.editor.getData())?s.classList.add("inplace-price-error"):s.classList.remove("inplace-price-error")}}),f.addInplacePrice(s.id,u,s),r.addClass("inplace-initialized"))))},r[0].addEventListener("mouseover",function(e){o.$apply(function(){t(e)})})}}}]),I.module("inplace").directive("inplacePriceButtons",function(){return{restrict:"A",scope:{inplacePriceButtons:"@",onInit:"&"},controller:"InplacePriceButtonsCtrl",controllerAs:"inplacePriceButtons",bindToController:!0,replace:!0,templateUrl:"/scripts/_partials/inplace/templates/priceButtons.html"}}),I.module("inplace").directive("inplacePricePanel",["$compile","$document","$window","inplaceService",function(e,t,n,i){return{restrict:"A",scope:{inplacePricePanel:"@",onInit:"&"},controller:"InplacePricePanelCtrl",controllerAs:"inplacePricePanel",templateUrl:"/scripts/_partials/inplace/templates/pricePanel.html",replace:!0,bindToController:!0}}])),I.module("inplace").directive("inplaceModal",[function(){return{restrict:"A",scope:{inplaceParams:"&",inplaceUrl:"@"},controller:"InplaceModalCtrl",controllerAs:"inplaceModal",bindToController:!0,link:function(t,e,n,i){e[0].addEventListener("click",function(e){e.preventDefault(),t.$apply(i.modalOpen)}),e.addClass("inplace-initialized")}}}]),I.module("inplace").directive("inplaceAutocomplete",["$compile","$document","$window","inplaceService",function(r,u,s,p){return{restrict:"A",scope:{inplaceParams:"&",autocompleteParams:"&inplaceAutocomplete",inplaceAutocompleteSelectorBlock:"@"},controller:"InplaceAutocompleteCtrl",controllerAs:"inplaceAutocomplete",bindToController:!0,templateUrl:"/scripts/_partials/inplace/templates/inplaceAutocomplete.html",replace:!0,transclude:!0,link:function(t,i,n,a,e){var l,c=i[0].querySelector("input"),o=e()[0];o&&(a.value=o.textContent),l=function(e,t){e.css({top:s.pageYOffset+t.bottom,right:u[0].body.clientWidth-t.right})},c.addEventListener("focus",function(){var e;i[0].classList.add("inplace-autocomplete-focus"),t.$apply(function(){a.startContent=a.value,a.active(),null==a.buttonsRendered&&(e=I.element('<div inplace-autocomplete-buttons="'+n.id+'"></div>'),l(e,i[0].getBoundingClientRect()),document.body.appendChild(e[0]),r(e)(t),a.buttonsRendered=!0)})}),c.addEventListener("blur",function(){i[0].classList.remove("inplace-autocomplete-focus"),setTimeout(function(){t.$apply(function(){(a.isShow=!1)!==a.clickedButtons&&null!=a.clickedButtons||a.save(),a.clickedButtons=!1})},100)}),c.addEventListener("keyup",function(e){var t,n;13===e.keyCode&&(i[0].classList.remove("inplace-autocomplete-focus"),t=document.createElement("input"),n=i[0].getBoundingClientRect(),t.className="inplace-input-fake",t.style.top=n.top+"px",t.style.left=n.left+"px",document.body.appendChild(t),t.focus(),setTimeout(function(){t.parentNode.removeChild(t)},100))}),null==n.id&&(n.$set("id","inplaceAutocomplete_"+d),d+=1),p.addInplaceAutocomplete(n.id,a),i.addClass("inplace-initialized")}}}]),I.module("inplace").directive("inplaceAutocompleteButtons",function(){return{restrict:"A",scope:{inplaceAutocompleteButtons:"@"},controller:"InplaceAutocompleteButtonsCtrl",controllerAs:"inplaceAutocompleteButtons",bindToController:!0,templateUrl:"/scripts/_partials/inplace/templates/inplaceAutocompleteButtons.html"}}),I.module("inplace").directive("inplacePropertiesNew",function(){return{restrict:"A",scope:{productId:"@"},controller:"InplacePropertiesNewCtrl",controllerAs:"inplacePropertiesNew",bindToController:!0,replace:!0,templateUrl:"/scripts/_partials/inplace/templates/propertiesNew.html"}}),I.module("inplace").directive("inplaceImage",["$compile","$document","$parse","$timeout","$window","inplaceService",function(f,e,g,v,t,h){return{restrict:"A",require:["inplaceImage","^?carousel","?^productViewItem","?^^","?^zoomer"],scope:!0,controller:"InplaceImageCtrl",controllerAs:"inplaceImage",bindToController:!0,replace:!0,link:function(n,e,i,t){var a,l,c,o,r,u=t[0],s=t[1],p=t[2],d=t[4],m=document.querySelector('[data-ng-controller="ProductCtrl as product"]');null==i.id&&(i.$set("id","inplaceImage_"+b),b+=1),u.carousel=s,u.productViewItem=p,u.product=null!=m?I.element(m).controller():null,u.inplaceParams=g(i.inplaceParams)(n),u.inplaceUrl=i.inplaceUrl,u.inplaceImageButtonsVisible=I.extend({add:!0,update:!0,delete:!0,permanentVisible:!1},new Function("return "+i.inplaceImageButtonsVisible)()||{}),a=function(e,t){return null!=r&&v.cancel(r),r=v(function(){return t.css({top:e[0].offsetTop+e[0].height,left:e[0].offsetLeft+e[0].width-t[0].offsetWidth}),!0},100)},l=function(e){var t=I.element('<div inplace-image-buttons="'+i.id+'"></div>');e[0].parentNode.appendChild(t[0]),f(t)(n),u.buttonsRendered=!0,a(e,t).finally(function(){u.buttons.rendered=!0})},c=function(){e[0].classList.add("inplace-image-focus"),n.$apply(function(){u.active(),null==u.buttonsRendered?l(e):null!=u.buttons&&null!=u.buttons.element&&a(e,u.buttons.element)})},o=function(){e[0].classList.remove("inplace-image-focus"),u.isActive=!1,setTimeout(function(){n.$apply(function(){null==u.buttons||0!=u.buttons.isHoverButtons&&null!=u.buttons.isHoverButtons||!0===u.inplaceImageButtonsVisible.permanentVisible||(u.showButtons=!1)})},100),null!=r&&v.cancel(r)},!0===u.inplaceImageButtonsVisible.permanentVisible&&l(e),null!=d?(e[0].parentNode.addEventListener("mouseenter",c),e[0].parentNode.addEventListener("mouseleave",o)):(e[0].addEventListener("mouseenter",c),e[0].addEventListener("mouseleave",o)),e.on("$destroy",function(){u.buttonsRendered=null}),h.addInplaceImage(i.id,u),e.addClass("inplace-initialized")}}}]),I.module("inplace").directive("inplaceImageButtons",function(){return{restrict:"A",scope:{inplaceImageButtons:"@"},controller:"InplaceImageButtonsCtrl",controllerAs:"inplaceImageButtons",bindToController:!0,replace:!0,templateUrl:"/scripts/_partials/inplace/templates/inplaceImageButtons.html",link:function(e,t,n,i){i.element=t,!0!==i.buttonsVisible.permanentVisible?(t[0].addEventListener("mouseenter",function(){e.$apply(function(){i.isHoverButtons=!0})}),t[0].addEventListener("mouseleave",function(){e.$apply(function(){i.isHoverButtons=!1}),setTimeout(function(){e.$apply(function(){0!=i.inplaceImage.isActive&&null!=i.inplaceImage.isActive||(i.inplaceImage.showButtons=!1)})},100)})):i.inplaceImage.showButtons=!0}}})}(window.angular),function(){"use strict";function e(t,n){this.change=function(e){n.setEnable(e).then(function(e){!0===e&&t.location.reload()})}}window.angular.module("inplace").controller("InplaceSwitchCtrl",e),e.$inject=["$window","inplaceService"]}(),function(l){"use strict";function e(n,e,i,t){var a=this;a.callbacks=[],a.active=function(){a.isShow=!0,a.startContent=a.editor.getData()},a.destroy=function(){a.buttons&&a.buttons.element.remove(),a.editor&&(a.editor.destroy(),i.$destroy()),t.removeAttr("contenteditable")},a.save=function(){var e,t=a.editor.getData();a.startContent!==t&&(null!=a.inplaceUrl?(e=l.extend(a.getParams(),{content:t}),n.save(a.inplaceUrl,e).finally(function(){a.isShow=!1,null!=a.inplaceOnSave&&a.inplaceOnSave({value:t,$scope:i})})):null!=a.inplaceOnSave&&a.inplaceOnSave({value:t,$scope:i}))},a.cancel=function(){a.isShow=!1,a.editor.setData(a.startContent)},a.addCallback=function(e){a.callbacks.push(e)},a.callCallbacks=function(e){e.forEach(function(e){e()})}}l.module("inplace").controller("InplaceRichCtrl",e),e.$inject=["inplaceService","$q","$scope","$element"]}(window.angular),function(){"use strict";function e(t,e,n,i,a){var l=this;l.$onInit=function(){l.richCtrl=e.getRich(l.inplaceRichButtons),l.richCtrl.buttons={element:t,ctrl:l},null!=l.onInit&&l.onInit({callback:l.calcAndSetPositionButtons})},l.$postLink=function(){l.calcAndSetPositionButtons()},l.calcAndSetPositionButtons=function(){var e=l.richCtrl.elementTrigger.getBoundingClientRect();t.css({top:a.pageYOffset+e.bottom+"px",right:i[0].body.clientWidth-e.right+"px"})},l.btnSave=function(){l.richCtrl.clickedButtons=!0,l.richCtrl.save()},l.btnCancel=function(){l.richCtrl.clickedButtons=!0,l.richCtrl.cancel()},l.destroy=function(){n.$destroy(),t.remove()}}window.angular.module("inplace").controller("InplaceRichButtonsCtrl",e),e.$inject=["$element","inplaceService","$scope","$document","$window"]}(),function(u){"use strict";function e(n,i,a,l,c,o){var r=this;r.$onInit=function(){r.inplaceParams=r.inplaceParams()},r.modalOpen=function(){var e,t;!1===c.hasModal("inplaceModal")&&c.renderModal("inplaceModal",o.instant("Js.Inplace.SeoSettings"),"<div data-ng-include=\"'/scripts/_partials/inplace/templates/modal.html'\"></div>","<div data-ng-include=\"'/scripts/_partials/inplace/templates/modalButtons.html'\"></div>",null,{inplace:r}),e=c.getModal("inplaceModal"),t=n.get("inplaceeditor/getmeta",{params:u.extend(r.inplaceParams,{rnd:Math.random()})}),i.all([e,t]).then(function(e){c.open("inplaceModal"),r.startData=e[1].data,r.current=e[1].data,e[0].modalScope.formData=r.current}),r.apply=function(){l.save(r.inplaceUrl,u.extend(r.inplaceParams,r.current)).then(function(){a.location.reload()})}},r.reset=function(){c.close("inplaceModal"),r.current=r.startData}}u.module("inplace").controller("InplaceModalCtrl",e),e.$inject=["$http","$q","$window","inplaceService","modalService","$translate"]}(window.angular),function(p){"use strict";function e(n,t,i,a,l,c,o){var r,u=this,s=!1;u.$onInit=function(){u.autocompleteParams=u.autocompleteParams(),u.inplaceParams=u.inplaceParams()},u.active=function(){u.isShow=!0},u.save=function(){u.startContent!==u.value&&l.save("inplaceeditor/propertyupdate",p.extend(u.inplaceParams,{content:u.value})).then(function(e){var t=e.data;!0===t.result?(c.pop("success",o.instant("Js.Inplace.PropertyHasBeenUpdate")),null!=t.obj&&p.extend(u.inplaceParams,t.obj),u.startContent=u.value):c.pop("error",o.instant("Js.Inplace.ErrorPropertyUpdate"))}).catch(function(){c.pop("error",o.instant("Js.Inplace.ErrorPropertyUpdate"))}).finally(function(){u.isShow=!1})},u.cancel=function(){u.isShow=!1,u.value=u.startContent},u.autocompleteApply=function(e,t){u.inplaceParams.propertyValueId=null!=t?t.Key:null},u.delete=function(e){var t;null!=u.inplaceAutocompleteSelectorBlock&&(t=a.closest(e.target,u.inplaceAutocompleteSelectorBlock)),null!=t&&t.parentNode.removeChild(t),u.value=null,l.save("inplaceeditor/propertydelete",p.extend(u.inplaceParams,{content:u.value})).finally(function(){u.isShow=!1,c.pop("success",o.instant("Js.Inplace.PropertyHasBeenDelete")),u.getPropertiesHtml(u.inplaceParams.productId).then(function(e){u.generate(e)})})},u.getPropertiesHtml=function(e){return t.get("/product/productproperties",{params:{productId:e,renderInplaceBlock:!1,rnd:Math.random()}}).then(function(e){return e.data})},u.generate=function(e){var t;!1===s&&((t=document.getElementById("properties")).parentNode.removeChild(t),s=!0),(r=r||document.getElementById("inplacePropertiesNewContainer")).innerHTML=e,n(r)(i)}}p.module("inplace").controller("InplaceAutocompleteCtrl",e),e.$inject=["$compile","$http","$scope","domService","inplaceService","toaster","$translate"]}(window.angular),function(){"use strict";function e(e){var t=this;t.$onInit=function(){t.inplaceAutocomplete=e.getInplaceAutocomplete(t.inplaceAutocompleteButtons)},t.btnSave=function(){t.inplaceAutocomplete.clickedButtons=!0,t.inplaceAutocomplete.save()},t.btnCancel=function(){t.inplaceAutocomplete.clickedButtons=!0,t.inplaceAutocomplete.cancel()}}window.angular.module("inplace").controller("InplaceAutocompleteButtonsCtrl",e),e.$inject=["inplaceService"]}(),function(s){"use strict";function e(n,t,i,e,a,l,c){var o,r=!1,u=this;u.$onInit=function(){u.autocompleteValueParams={productId:u.productId},u.inplaceParams={productId:u.productId}},u.save=function(){e(function(){return l.save("inplaceeditor/propertyadd",s.extend(u.inplaceParams,{name:u.name,value:u.value})).then(function(e){null!=e.data?(u.name="",u.value="",u.form.$setPristine(),u.inplaceParams.propertyId=null,u.inplaceParams.propertyValueId=null,a.pop("success",c.instant("Js.Inplace.PropertyHasBeenAdded")),u.htmlUpdate=!0,u.getPropertiesHtml(u.productId).then(function(e){u.generate(e)})):a.pop("error",c.instant("Js.Inplace.ErrorPropertyAdding"))})},100)},u.autocompleteNameApply=function(e,t){null!=t?(u.autocompleteValueParams.propertyId=t.Key,u.inplaceParams.propertyId=t.Key):(u.autocompleteValueParams.propertyId=null,u.inplaceParams.propertyId=null),u.inplaceParams.name=e},u.autocompleteValueApply=function(e,t){u.inplaceParams.propertyValueId=null!=t?t.Key:null,u.inplaceParams.value=e},u.getPropertiesHtml=function(e){return t.get("/product/productproperties",{params:{productId:e,renderInplaceBlock:!1,rnd:Math.random()}}).then(function(e){return e.data})},u.generate=function(e){var t;!1===r&&(null!=(t=document.getElementById("properties"))&&t.parentNode.removeChild(t),r=!0),(o=o||document.getElementById("inplacePropertiesNewContainer")).innerHTML=e,n(o)(i)}}s.module("inplace").controller("InplacePropertiesNewCtrl",e),e.$inject=["$compile","$http","$scope","$timeout","toaster","inplaceService","$translate"]}(window.angular),function(a){"use strict";function e(p,e,d,m,u,t,i){var f=this;f.$onInit=function(){f.tagImage=e[0],f.isActive=!1,f.isHoverButtons=!1},f.active=function(){f.isActive=!0,f.showButtons=!0},f.fileDrop=function(e,t,n){return f.fileChange(e,t,null!=f.inplaceParams.id&&0!==f.inplaceParams.id?"update":"add")},f.fileChange=function(e,t,n){if(null==n)throw Error("Parameter 'command' required for inplace image");return null!=f.productViewItem?(null!=f.productViewItem.picture.PhotoId&&a.extend(f.inplaceParams,{id:f.productViewItem.picture.PhotoId}),null!=f.productViewItem.colorSelected&&a.extend(f.inplaceParams,{colorId:f.productViewItem.colorSelected.ColorId})):null!=f.product&&(null!=f.product.picture.PhotoId&&"Review"!==f.inplaceParams.field&&a.extend(f.inplaceParams,{id:f.product.picture.PhotoId}),null!=f.product.colorSelected&&a.extend(f.inplaceParams,{colorId:f.product.colorSelected.ColorId})),f.inplaceParams.command=n,i.upload({url:f.inplaceUrl,data:a.extend(f.inplaceParams,{rnd:Math.random()}),file:e}).then(function(e){switch(n){case"add":f.addedImage(e.data,f.inplaceParams.field);break;case"update":f.updatedImage(e.data,f.inplaceParams.field);break;case"delete":f.deletedImage(e.data,f.inplaceParams.field)}})},f.addedImage=function(e,t){var n,i,a,l,c,o,r=f.tagImage;if(null!=e&&0<e.length&&null!=t)switch(t){case"Logo":case"Brand":case"News":case"CategorySmall":case"CategoryBig":case"Review":r.src=e[0].filename;break;case"Product":for(var u=0,s=e.length;u<s;u++)r.src=e[u].filename,(l=new Function("return "+r.getAttribute("data-inplace-params"))()).id=e[u].id,r.setAttribute("data-inplace-params",JSON.stringify(l).replace(/"/g,"'")),0===u&&(null!=f.productViewItem?(f.productViewItem.picture.PhotoId=l.id,f.productViewItem.clearPhotos()):null!=f.product&&m.location.reload(!0));break;case"Carousel":a=(i=(n=f.carousel).carouselNative.getActiveItem().cloneNode(!0)).querySelector("[data-inplace-image]"),i.querySelector(".inplace-buttons").parentNode.removeChild(i.querySelector(".inplace-buttons")),(l=new Function("return "+a.getAttribute("data-inplace-params"))()).id=e[0].id,a.id="inplaceImage_"+e[0].id,a.setAttribute("data-inplace-params",JSON.stringify(l).replace(/"/g,"'")),(c=new Function("return "+a.getAttribute("data-inplace-image-buttons-visible"))()).add=!0,c.update=!0,c.delete=!0,c.permanentVisible=!1,a.setAttribute("data-inplace-image-buttons-visible",JSON.stringify(c).replace(/"/g,"'")),a.src=e[0].filename,1===n.carouselNative.items.length&&!0===(o=new Function("return "+n.carouselNative.getActiveItem().querySelector("[data-inplace-image]").getAttribute("data-inplace-image-buttons-visible"))()).add&&!1===o.update&&!1===o.delete&&n.carouselNative.removeItem(n.carouselNative.getActiveItem(),!1),n.carouselNative.addItem(i),a.complete&&void 0===a.naturalWidth&&0!==a.naturalWidth?(n.carouselNative.update(),n.carouselNative.goto(0<n.carouselNative.items.length?n.carouselNative.items.length-1:0)):a.onload=function(){n.carouselNative.update(),n.carouselNative.goto(0<n.carouselNative.items.length?n.carouselNative.items.length-1:0)},p(a)(d);break;default:throw Error("Unknow type for inplace image: "+t)}},f.updatedImage=function(e,t){var n,i=f.tagImage;if(null!=e&&0<e.length&&null!=t)switch(t){case"Logo":case"Brand":case"News":case"CategorySmall":case"CategoryBig":i.src=e[0].filename;break;case"Carousel":i.src=e[0].filename,f.carousel.carouselNative.update();break;case"Product":i.src=e[0].filename,(n=new Function("return "+i.getAttribute("data-inplace-params"))()).id=e[0].id,i.setAttribute("data-inplace-params",JSON.stringify(n).replace(/"/g,"'")),null!=f.productViewItem?(f.productViewItem.picture.PhotoId=n.id,f.productViewItem.clearPhotos()):null!=f.product&&m.location.reload();break;case"Review":i.src=e[0].filename,f.inplaceParams.id=e[0].id;break;default:throw Error("Unknow type for inplace image: "+t)}},f.deletedImage=function(e,t){var n,i,a,l,c,o,r=f.tagImage;if(null!=e&&0<e.length&&null!=t)switch(t){case"Logo":case"Brand":case"News":case"CategorySmall":case"CategoryBig":r.src=e[0].filename;break;case"Product":r.src=e[0].filename,(c=new Function("return "+r.getAttribute("data-inplace-params"))()).id=e[0].id,r.setAttribute("data-inplace-params",JSON.stringify(c).replace(/"/g,"'")),null!=f.productViewItem?(f.productViewItem.picture.PhotoId=c.id,f.productViewItem.clearPhotos()):null!=f.product&&m.location.reload();break;case"Review":r.src=e[0].filename,f.inplaceParams.id=e[0].id;break;case"Carousel":null!=(n=f.carousel)&&(1===n.carouselNative.items.length&&(l=(a=n.carouselNative.getActiveItem().cloneNode(!0)).querySelector("[data-inplace-image]"),a.querySelector(".inplace-buttons").parentNode.removeChild(a.querySelector(".inplace-buttons")),(c=new Function("return "+l.getAttribute("data-inplace-params"))()).id=0,l.setAttribute("data-inplace-params",JSON.stringify(c).replace(/"/g,"'")),(o=new Function("return "+l.getAttribute("data-inplace-image-buttons-visible"))()).update=!1,o.delete=!1,o.permanentVisible=!0,l.setAttribute("data-inplace-image-buttons-visible",JSON.stringify(o).replace(/"/g,"'")),l.src=e[0].filename),i=u.closest(r,".js-carousel-item").carouselItemData.index,n.carouselNative.removeItem(n.carouselNative.items[i],!1),null!=a&&(n.carouselNative.addItem(a),p(l)(d)),null==l||l.complete&&void 0===l.naturalWidth&&0!==l.naturalWidth?(n.carouselNative.update(),n.carouselNative.goto(n.carouselNative.items.length-1)):l.onload=function(){n.carouselNative.update(),n.carouselNative.goto(n.carouselNative.items.length-1)});break;default:throw Error("Unknow type for inplace image: "+t)}}}a.module("inplace").controller("InplaceImageCtrl",e),e.$inject=["$compile","$element","$scope","$window","domService","inplaceService","Upload"]}(window.angular),function(){"use strict";function e(e){var n=this;n.$onInit=function(){n.inplaceImage=e.getInplaceImage(n.inplaceImageButtons),(n.inplaceImage.buttons=n).buttonsVisible=n.inplaceImage.inplaceImageButtonsVisible},n.add=function(e,t){"change"===t.type&&n.inplaceImage.fileChange(e,t,"add")},n.update=function(e,t){"change"===t.type&&n.inplaceImage.fileChange(e,t,"update")},n.delete=function(e){n.inplaceImage.fileChange(null,e,"delete")}}window.angular.module("inplace").controller("InplaceImageButtonsCtrl",e),e.$inject=["inplaceService"]}(),function(l){"use strict";function e(n,i,e,t){var a=this;a.callbacks=[],a.$onInit=function(){a.needReinit={},a.inplaceParams=a.inplaceParams()},a.active=function(){a.startContent=a.editor.getData(),a.isShow=!0},a.save=function(){if(null!=a.product&&null!=a.product.offerSelected){var e,t=a.convertToFloat(a.editor.getData());null!=t&&(e=l.extend(a.inplaceParams,{content:t,id:a.product.offerSelected.OfferId,field:a.type}),n.save(a.inplaceUrl,e).finally(function(){a.isShow=!1,a.product.refreshPrice().then(function(){a.setNeedReinit(),i(function(){a.callCallbacks(a.callbacks)},300)})}))}},a.setNeedReinit=function(){for(var e in a.needReinit)a.needReinit.hasOwnProperty(e)&&(a.needReinit[e]=!0)},a.cancel=function(){a.isShow=!1,a.editor.container.$.innerHTML=a.startContent},a.convertToFloat=function(e){var t=e.replace(/,/g,".").replace(/ /g,"").replace(/&nbsp;/g,"");return t=0===e.length?0:!1===/^[0-9]+(\.[0-9][0-9])?$/.test(t)?null:parseFloat(t)},a.addCallback=function(e){a.callbacks.push(e)},a.callCallbacks=function(e){e.forEach(function(e){e()})},a.destroy=function(){e.$destroy()}}l.module("inplace").controller("InplacePriceCtrl",e),e.$inject=["inplaceService","$timeout","$scope","$element"]}(window.angular),function(){"use strict";function e(n,e,i,t){var a=this;a.$onInit=function(){a.inplacePrice=e.getInplacePrice(a.inplacePricePanel),a.inplacePrice.panel={element:n,ctrl:a},null!=a.onInit&&a.onInit({callback:a.calcAndSetPositionPanel})},a.$postLink=function(){a.calcAndSetPositionPanel()},a.calcAndSetPositionPanel=function(){var e=a.inplacePrice.elementTrigger.getBoundingClientRect(),t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);n.css({bottom:t-i.pageYOffset-e.top,left:e.left})}}window.angular.module("inplace").controller("InplacePricePanelCtrl",e),e.$inject=["$element","inplaceService","$window","$scope"]}(),function(){"use strict";function e(t,e,n,i){var a=this;a.$onInit=function(){a.inplacePrice=e.getInplacePrice(a.inplacePriceButtons),a.inplacePrice.buttons={element:t,ctrl:a},null!=a.onInit&&a.onInit({callback:a.calcAndSetPositionButtons})},a.$postLink=function(){a.calcAndSetPositionButtons()},a.calcAndSetPositionButtons=function(){var e=a.inplacePrice.elementTrigger.getBoundingClientRect();t.css({top:n.pageYOffset+e.bottom,right:i[0].body.clientWidth-e.right})},a.btnSave=function(){a.inplacePrice.clickedButtons=!0,a.inplacePrice.save()},a.btnCancel=function(){a.inplacePrice.clickedButtons=!0,a.inplacePrice.cancel()}}window.angular.module("inplace").controller("InplacePriceButtonsCtrl",e),e.$inject=["$element","inplaceService","$window","$document"]}(),function(){"use strict";function e(e){var t=this;t.$onInit=function(){t.state=e.getProgressState()}}window.angular.module("inplace").controller("InplaceProgressCtrl",e),e.$inject=["inplaceService"]}(),function(a){"use strict";function e(n){var e=this,t={show:!1},i={rich:{},inplaceAutocomplete:{},inplaceImage:{},inplacePrice:{}};e.addRich=function(e,t,n){t.elementTrigger=n,i.rich[e]=t},e.getRich=function(e){return i.rich[e]},e.addInplaceAutocomplete=function(e,t){i.inplaceAutocomplete[e]=t},e.getInplaceAutocomplete=function(e){return i.inplaceAutocomplete[e]},e.addInplaceImage=function(e,t){i.inplaceImage[e]=t},e.getInplaceImage=function(e){return i.inplaceImage[e]},e.addInplacePrice=function(e,t,n){i.inplacePrice[e]=t,i.inplacePrice[e].elementTrigger=n},e.getInplacePrice=function(e){return i.inplacePrice[e]},e.save=function(e,t){return n.post(e,a.extend(t,{rnd:Math.random()}))},e.setEnable=function(e){return n.post("inplaceeditor/setenable",{isEnabled:e}).then(function(e){return e.data})},e.getProgressState=function(){return t},e.startProgress=function(){t.show=!0},e.stopProgress=function(){t.show=!1},e.destroyAll=function(){Object.keys(i).forEach(function(t){Object.keys(i[t]).forEach(function(e){null!=i[t][e].destroy&&(i[t][e].destroy(),delete i[t][e])})})}}a.module("inplace").service("inplaceService",e),e.$inject=["$http"]}(window.angular);