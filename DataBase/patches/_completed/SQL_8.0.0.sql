GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Tasks.NavMenu.ControlProjects','Управление проектами')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Tasks.NavMenu.ControlProjects','Control leads')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Commonsettings', 'Общие настройки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Commonsettings', 'Common settings')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Userssettings', 'Сотрудники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Userssettings', 'Users settings')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Settingssocial', 'Социальные сети')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Settingssocial', 'Social networks')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Products', 'Товары')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Products', 'Products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Shippingsmethods', 'Доставка')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Shippingsmethods', 'Delivery')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.SettingsAPI', 'API')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.SettingsAPI', 'API')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.SettingsCheckout', 'Заказы')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.SettingsCheckout', 'Orders')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Paymentmethods', 'Оплата')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Paymentmethods', 'Payment')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Settingsmail', 'Почта, уведомления')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Settingsmail', 'Mail, notifications')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Leads', 'Лиды')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Leads', 'Leads')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Tasks', 'Задачи')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Tasks', 'Tasks')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Customers', 'Покупатели')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Customers', 'Customers')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Telephony', 'IP Телефония')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Telephony', 'IP Telephony')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Systemsettings', 'Системные настройки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Systemsettings', 'Системные настройки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Bonussystem', 'Бонусная система')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Bonussystem', 'Bonus system')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Partners', 'Партнеры')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Partners', 'Partners')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Templatesdocx', 'Шаблоны документов')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Templatesdocx', 'Document Templates')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Booking', 'Бронирование')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Booking', 'Booking')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Coupons', 'Скидки, купоны, сертификаты')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Coupons', 'Discounts, coupons, certificates')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.News', 'Новости')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.News', 'News')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Mobile', 'Мобильная версия')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Mobile', 'Mobile version')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Commonpage.Seo', 'SEO и счетчики')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Commonpage.Seo', 'SEO and counters')
GO--


ALTER TABLE [Catalog].[RelatedProducts] ADD SortOrder int NULL
GO--
UPDATE [Catalog].[RelatedProducts] SET SortOrder = 0
GO--
ALTER TABLE [Catalog].[RelatedProducts] ALTER COLUMN SortOrder int NOT NULL
GO--

CREATE PROCEDURE [Catalog].[ChangeRelatedProductsSorting]
	@Id int,
	@prevId int,
	@nextId int
AS
BEGIN
	IF @prevId IS NULL AND @nextId IS NULL
		RETURN;

	DECLARE @NewSort int

	DECLARE @productId int = (SELECT ProductID FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @Id)
	DECLARE @relatedType int = (SELECT RelatedType FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @Id)

	DECLARE @prevSort int = (SELECT SortOrder FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @prevId)
	DECLARE @nextSort int = (SELECT SortOrder FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @nextId)

	if @prevSort IS NULL OR @nextSort IS NULL
	BEGIN
		-- make related product first or last
		SELECT @NewSort = 
			(SELECT CASE WHEN @prevSort IS NULL 
				THEN ISNULL(MIN(SortOrder), 0) - 10 
				ELSE ISNULL(MAX(SortOrder), 0) + 10 END 
			FROM [Catalog].[RelatedProducts]
			WHERE RelatedProductID <> @Id AND RelatedType = @relatedType AND ProductID = @productId)
	END
	ELSE
	BEGIN
		if @nextSort - @prevSort > 1
		BEGIN
			-- between prev and next
			SELECT @NewSort = (@prevSort + ((@nextSort - @prevSort) / 2))
		END
		ELSE
		BEGIN
			UPDATE [Catalog].[RelatedProducts] SET SortOrder = RelatedProductsSort.Sort * 10
			FROM ( 
				SELECT RelatedProductID as Id, ROW_NUMBER() OVER (ORDER BY SortOrder) AS Sort FROM [Catalog].[RelatedProducts]
				WHERE RelatedType = @relatedType AND ProductID = @productId
			) RelatedProductsSort INNER JOIN [Catalog].[RelatedProducts] ON RelatedProductsSort.Id = [RelatedProducts].RelatedProductID

			SELECT @prevSort = (SELECT SortOrder FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @prevId)
			SELECT @nextSort = (SELECT SortOrder FROM [Catalog].[RelatedProducts] WHERE RelatedProductID = @nextId)

			SELECT @NewSort = (@prevSort + ((@nextSort - @prevSort) / 2))
		END
	END

	if @NewSort IS NOT NULL
		UPDATE [Catalog].[RelatedProducts] SET SortOrder = @NewSort WHERE RelatedProductID = @Id
END
GO--

ALTER PROCEDURE [Catalog].[sp_AddRelatedProduct]
	@ProductID int,
	@RelatedProductID int,
	@RelatedType int
AS
BEGIN
	INSERT INTO [Catalog].[RelatedProducts]
			   (ProductID
			   ,LinkedProductID
			   ,RelatedType
			   ,SortOrder)
		 VALUES
			   (@ProductID
			   ,@RelatedProductID
			   ,@RelatedType
			   ,(SELECT ISNULL(MAX(SortOrder), 0) + 10 FROM [Catalog].[RelatedProducts] WHERE ProductID = @ProductID AND RelatedType = @RelatedType))
END
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OffersSelect.ProductCount', 'Кол-во')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OffersSelect.ProductCount', 'Amount')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.ExportImport.MultiOrder.BonusCost', 'Оплачено бонусами')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.ExportImport.MultiOrder.BonusCost', 'Paid with bonuses')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Analytics.ExportOrders.BonusCost', 'Выгрузить заказы с бонусами')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Analytics.ExportOrders.BonusCost', 'Export orders with bonuses')

GO--

ALTER PROCEDURE [Catalog].[sp_GetCOUNT_Ratio]
	   
	@CustomerId uniqueidentifier = NULL,
	@ProductID int
AS
BEGIN

	SELECT COUNT(RatioID) AS COUNTID
	FROM [Catalog].[Ratio]
	WHERE [ProductID] = @ProductID AND (@CustomerId IS NULL OR CustomerId = @CustomerId)

END

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Catalog.CreateCopyOfProduct', 'Создать копию')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Catalog.CreateCopyOfProduct', 'Create сopy')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.CopyProduct.Count', 'Количество копий')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.CopyProduct.Count', 'Count')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.CopyProduct.AvailableVariablesTitle', 'Для поля доступны переменные:')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.CopyProduct.AvailableVariablesTitle', 'For this field available variables:')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.CopyProduct.AvailableVariablesDescription', 'Переменная #N# будет заменена на порядковый номер копии')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.CopyProduct.AvailableVariablesDescription', 'Variable #N# will be replaced by serial number of a copy')
UPDATE [Settings].[Localization] SET [ResourceValue] = 'Название товара' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Admin.Js.CopyProduct.Name'
UPDATE [Settings].[Localization] SET [ResourceValue] = 'Product name' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Admin.Js.CopyProduct.Name'

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Checkout.CheckoutComment.CommentPlaceholder', 'Укажите тут свои комментарии и пожелания по данному заказу')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Checkout.CheckoutComment.CommentPlaceholder', 'Enter your comments and suggestions for the order there')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Js.BuyOneClick.CommentPlaceholder', 'Укажите тут свои комментарии и пожелания по данному заказу')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Js.BuyOneClick.CommentPlaceholder', 'Enter your comments and suggestions for the order there')

GO--


IF (NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'CMS' AND  TABLE_NAME = 'LandingSite_Product'))
BEGIN

	CREATE TABLE [CMS].[LandingSite_Product](
		[ProductId] [int] NOT NULL,
		[LandingSiteId] [int] NOT NULL,
	 CONSTRAINT [PK_LandingSite_Product] PRIMARY KEY CLUSTERED 
	(
		[ProductId] ASC,
		[LandingSiteId] ASC
	)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
	) ON [PRIMARY]

	ALTER TABLE [CMS].[LandingSite_Product]  WITH CHECK ADD  CONSTRAINT [FK_LandingSite_Product_LandingSite] FOREIGN KEY([LandingSiteId])
	REFERENCES [CMS].[LandingSite] ([Id])
	ON DELETE CASCADE

	ALTER TABLE [CMS].[LandingSite_Product] CHECK CONSTRAINT [FK_LandingSite_Product_LandingSite]

	ALTER TABLE [CMS].[LandingSite_Product]  WITH CHECK ADD  CONSTRAINT [FK_LandingSite_Product_Product] FOREIGN KEY([ProductId])
	REFERENCES [Catalog].[Product] ([ProductId])
	ON DELETE CASCADE

	ALTER TABLE [CMS].[LandingSite_Product] CHECK CONSTRAINT [FK_LandingSite_Product_Product]	
END

GO--

If Not Exists(Select 1 From [CMS].[LandingSite_Product])
	Insert Into [CMS].[LandingSite_Product] (ProductId, LandingSiteId) 
		Select [AdditionalSalesProductId], [Id] From [CMS].[LandingSite] Where [AdditionalSalesProductId] is not null and exists(select 1 from [Catalog].[Product] Where ProductId = [AdditionalSalesProductId])
GO--

ALTER PROCEDURE [Settings].[sp_GetExportFeedProducts] 
     @exportFeedId int
	,@exportNotAvailable bit
	,@selectedCurrency NVARCHAR(10)
	,@allowPreOrder bit = 0
	,@exportAllProducts bit
	,@onlyMainOfferToExport bit
	,@sqlMode NVARCHAR(200) = 'GetProducts'
AS
BEGIN
	
	DECLARE @res TABLE (productId INT PRIMARY KEY CLUSTERED);
	
	DECLARE @lcategory TABLE (CategoryId INT PRIMARY KEY CLUSTERED);
	DECLARE @lcategorytemp TABLE (CategoryId INT);
	DECLARE @l TABLE (CategoryId INT PRIMARY KEY CLUSTERED, Opened bit);

	INSERT INTO @l
	SELECT t.CategoryId, t.Opened
	FROM [Settings].[ExportFeedSelectedCategories] AS t
	INNER JOIN CATALOG.Category ON t.CategoryId = Category.CategoryId
	WHERE [ExportFeedId] = @exportFeedId
		AND HirecalEnabled = 1
		AND Enabled = 1


	DECLARE @l1 INT

	SET @l1 = (
			SELECT MIN(CategoryId)
			FROM @l
			);

	WHILE @l1 IS NOT NULL
	BEGIN
		if ((Select Opened from @l where CategoryId=@l1)=1)
		begin
			INSERT INTO @lcategorytemp
			SELECT @l1
		end
		else
		begin
	 		INSERT INTO @lcategorytemp
			SELECT id
			FROM Settings.GetChildCategoryByParent(@l1)
		end

		SET @l1 = (
				SELECT MIN(CategoryId)
				FROM @l
				WHERE CategoryId > @l1
				);
	END;

	INSERT INTO @lcategory
	SELECT Distinct tmp.CategoryId
	FROM @lcategorytemp AS tmp
	INNER JOIN CATALOG.Category ON Category.CategoryId = tmp.CategoryId
	WHERE HirecalEnabled = 1
		AND Enabled = 1;

	IF @sqlMode = 'GetCountOfProducts'
	BEGIN
		SELECT COUNT(Distinct OfferId)
		FROM [Catalog].[Product] p 
		INNER JOIN [Catalog].[Offer] offer ON offer.[ProductID] = p.[ProductID]
		INNER JOIN [Catalog].[ProductCategories] productCategories ON productCategories.[ProductID] = p.[ProductID]
		INNER JOIN  @lcategory lc ON lc.CategoryId = productCategories.CategoryID
		LEFT JOIN [Settings].[ExportFeedExcludedProducts]ep ON ep.ProductId = p.ProductId and ep.ExportFeedId=@exportFeedId															
		WHERE 
		(
			ep.ProductID IS NULL 
			OR 
			@exportAllProducts = 1
		)
		AND
			(offer.Price > 0 OR @exportNotAvailable = 1)
		AND (
			offer.Amount > 0
			OR (p.AllowPreOrder = 1 and  @allowPreOrder = 1)
			OR @exportNotAvailable = 1
			)
		AND CategoryEnabled = 1
		AND (p.Enabled = 1 OR @exportNotAvailable = 1)	
		AND (@onlyMainOfferToExport = 0 OR Offer.Main = 1)
	END
	IF @sqlMode = 'GetProducts'
	BEGIN
	with cte as (
	SELECT Distinct tmp.CategoryId
	FROM @lcategorytemp AS tmp
	INNER JOIN CATALOG.Category ON Category.CategoryId = tmp.CategoryId

	WHERE HirecalEnabled = 1 AND Enabled = 1)	
		SELECT p.[Enabled]
			,p.[ProductID]
			,p.[Discount]
			,p.[DiscountAmount]
			,AllowPreOrder
			,Amount
			,crossCategory.[CategoryId] AS [ParentCategory]
			,[Offer].[Price] AS Price
			,ShippingPrice
			,p.[Name]
			,p.[UrlPath]
			,p.[Description]
			,p.[BriefDescription]
			,p.SalesNote
			,OfferId
			,p.ArtNo
			,[Offer].Main
			,[Offer].ColorID
			,ColorName
			,[Offer].SizeID
			,SizeName
			,BrandName
			,country1.CountryName as BrandCountry
			,country2.CountryName as BrandCountryManufacture
			,GoogleProductCategory
			,YandexMarketCategory
			,YandexTypePrefix
			,YandexModel
			,Gtin
			,Adult
			,CurrencyValue
			,[Settings].PhotoToString(Offer.ColorID, p.ProductId) AS Photos
			,ManufacturerWarranty
			,[Weight]
			,p.[Enabled]
			,[Offer].SupplyPrice AS SupplyPrice
			,[Offer].ArtNo AS OfferArtNo
			,p.BarCode
			,p.Bid			
			,p.YandexSizeUnit
			,p.MinAmount
			,p.Multiplicity			
			,p.YandexName
			,p.YandexDeliveryDays
			,p.Length
			,p.Width
			,p.Height		
		FROM [Catalog].[Product] p 
		INNER JOIN [Catalog].[Offer] offer ON offer.[ProductID] = p.[ProductID]
		--INNER JOIN [Catalog].[ProductCategories] productCategories ON productCategories.[ProductID] = p.[ProductID]
		--RIGHT JOIN  @lcategory lc ON lc.CategoryId = productCategories.CategoryID
		LEFT JOIN [Settings].[ExportFeedExcludedProducts]ep ON ep.ProductId = p.ProductId and ep.ExportFeedId=@exportFeedId		
		LEFT JOIN [Catalog].[Color] ON [Color].ColorID = [Offer].ColorID
		LEFT JOIN [Catalog].[Size] ON [Size].SizeID = [Offer].SizeID
		LEFT JOIN [Catalog].Brand ON Brand.BrandID = p.BrandID
		LEFT JOIN [Customers].Country as country1 ON Brand.CountryID = country1.CountryID
		LEFT JOIN [Customers].Country as country2 ON Brand.CountryOfManufactureID = country2.CountryID
		INNER JOIN [Catalog].Currency ON Currency.CurrencyID = p.CurrencyID
		cross apply(SELECT TOP (1) [ProductCategories].[CategoryId] from [Catalog].[ProductCategories]
					INNER JOIN  cte lc ON lc.CategoryId = productCategories.CategoryID
					where  [ProductCategories].[ProductID] = p.[ProductID]
					Order By [ProductCategories].Main DESC, [ProductCategories].[CategoryId] ) crossCategory	
		WHERE 
		(
			ep.ProductID IS NULL 
			OR 
			@exportAllProducts = 1
		)		
		AND
			(offer.Price > 0 OR @exportNotAvailable = 1)
		AND (
			offer.Amount > 0
			OR (p.AllowPreOrder = 1 and  @allowPreOrder = 1)
			OR @exportNotAvailable = 1
			)
		AND CategoryEnabled = 1
		AND (p.Enabled = 1 OR @exportNotAvailable = 1)	
		AND (@onlyMainOfferToExport = 0 OR Offer.Main = 1)
	END
	IF @sqlMode = 'GetOfferIds'
	BEGIN
		SELECT Distinct OfferId
		FROM [Catalog].[Product] p 
		INNER JOIN [Catalog].[Offer] offer ON offer.[ProductID] = p.[ProductID]
		INNER JOIN [Catalog].[ProductCategories] productCategories ON productCategories.[ProductID] = p.[ProductID]
		INNER JOIN  @lcategory lc ON lc.CategoryId = productCategories.CategoryID
		LEFT JOIN [Settings].[ExportFeedExcludedProducts]ep ON ep.ProductId = p.ProductId and ep.ExportFeedId=@exportFeedId															
		WHERE 
		(
			ep.ProductID IS NULL 
			OR 
			@exportAllProducts = 1
		)
		AND
			(offer.Price > 0 OR @exportNotAvailable = 1)
		AND (
			offer.Amount > 0
			OR (p.AllowPreOrder = 1 and  @allowPreOrder = 1)
			OR @exportNotAvailable = 1
			)
		AND CategoryEnabled = 1
		AND (p.Enabled = 1 OR @exportNotAvailable = 1)	
		AND (@onlyMainOfferToExport = 0 OR Offer.Main = 1)
	END
END

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.Title', 'Выгрузка товаров');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.Title', 'Export products');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.SubTitle', 'Выгрузка данных по товарам из оплаченных заказов');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.SubTitle', 'Export data for goods from paid orders');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.DateSpan', 'Временной интервал');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.DateSpan', 'Time interval');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.DateSpanFrom', 'От');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.DateSpanFrom', 'From');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.DateSpanTo', 'До');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.DateSpanTo', 'To');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.ColumnSeparator', 'Разделитель между колонками');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.ColumnSeparator', 'Separator between columns');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.FileEncoding', 'Кодировка файла');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.FileEncoding', 'File encoding');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.Unload', 'Выгружать');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.Unload', 'Unload');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.Categories', 'Категории');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.Categories', 'Categories');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.OneProduct', 'Один товар');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.OneProduct', 'One product');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.EnterProductArtno', 'Введите артикул товара');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.EnterProductArtno', 'Enter product article');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.ExportProducts.Export', 'Экспортировать');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.ExportProducts.Export', 'Export');

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.CustomersAtGroup','Покупатели в группе')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.CustomersAtGroup','Customers at group')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.UnloadingDataByCustomers','Выгрузка данных по покупателям')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.UnloadingDataByCustomers','Unloading data by customers')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.GroupOfCustomers','Группа покупателей')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.GroupOfCustomers','Group of customers')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.TimeInterval','Временной интервал')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.TimeInterval','Time interval')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.ColumnSeparator','Разделитель между колонками')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.ColumnSeparator','Column separator')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.AdressSeparator','Разделитель между адресами')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.AdressSeparator','Adress separator')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.FilesEncoding','Кодировка файла')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.FilesEncoding','File''s encoding')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.UnloadingCustomers','Выгрузка покупателей')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.UnloadingCustomers','Unloading customers')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.CustomersFrom','От')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.CustomersFrom','From')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportCustomers.CustomersTo','До')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportCustomers.CustomersTo','To')

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Title', 'Выгрузка заказов');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Status', 'Выгружать заказы со статусом');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Period', 'Выгрузить заказы за период');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Period.From', 'От');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Period.To', 'До');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Encoding', 'Кодировка файла');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ExportOrders.Export', 'Экспортировать');
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportOrders.OrderSum','Сумма заказа')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportOrders.OrderSum','Order price')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportOrders.Paid','Выгрузить заказы со статусом оплаты')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportOrders.Paid','Export orders with payment status')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportOrders.Shipping','Выгрузить заказы с методом доставки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportOrders.Shipping','Export orders with shipping method')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ExportOrders.City','Выгрузить заказы с городом доставки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ExportOrders.City','Export orders with shipping city')

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Нет доступных купонов, добавьте новый' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Admin.Js.AddEditYandexPromo.ErrorGettingCouponsCount'

GO--

ALTER TABLE Catalog.Product ADD Hidden bit NULL
GO--
UPDATE Catalog.Product SET Hidden = 0
GO--
ALTER TABLE Catalog.Product ALTER COLUMN Hidden bit NOT NULL
GO--

ALTER PROCEDURE [Catalog].[sp_AddProduct]
    @ArtNo nvarchar(100) = '',
    @Name nvarchar(255),
    @Ratio float,
    @Discount float,
    @DiscountAmount float,
    @Weight float,
    @BriefDescription nvarchar(max),
    @Description nvarchar(max),
    @Enabled tinyint,
    @Recomended bit,
    @New bit,
    @BestSeller bit,
    @OnSale bit,
    @BrandID int,
    @AllowPreOrder bit,
    @UrlPath nvarchar(150),
    @Unit nvarchar(50),
    @ShippingPrice float,
    @MinAmount float,
    @MaxAmount float,
    @Multiplicity float,
    @HasMultiOffer bit,
    @SalesNote nvarchar(50),
    @GoogleProductCategory nvarchar(500),
    @YandexMarketCategory nvarchar(500),
    @Gtin nvarchar(50),
    @Adult bit,
    @Length float,
    @Width float,
    @Height float,
    @CurrencyID int,
    @ActiveView360 bit,
    @ManufacturerWarranty bit,
    @ModifiedBy nvarchar(50),
    @YandexTypePrefix nvarchar(500),
    @YandexModel nvarchar(500),
    @BarCode nvarchar(50),
    @Bid float,
    @AccrueBonuses bit,
    @Taxid int,
    @PaymentSubjectType int,
    @PaymentMethodType int,
    @YandexSizeUnit nvarchar(10),
    @DateModified datetime,
    @YandexName nvarchar(255),
    @YandexDeliveryDays nvarchar(5),
    @CreatedBy nvarchar(50),
    @Hidden bit
AS
BEGIN
    Declare @Id int
    INSERT INTO [Catalog].[Product]
        ([ArtNo]
        ,[Name]
        ,[Ratio]
        ,[Discount]
        ,[DiscountAmount]
        ,[Weight]
        ,[BriefDescription]
        ,[Description]
        ,[Enabled]
        ,[DateAdded]
        ,[DateModified]
        ,[Recomended]
        ,[New]
        ,[BestSeller]
        ,[OnSale]
        ,[BrandID]
        ,[AllowPreOrder]
        ,[UrlPath]
        ,[Unit]
        ,[ShippingPrice]
        ,[MinAmount]
        ,[MaxAmount]
        ,[Multiplicity]
        ,[HasMultiOffer]
        ,[SalesNote]
        ,GoogleProductCategory
        ,YandexMarketCategory
        ,Gtin
        ,Adult
        ,Length
        ,Width
        ,Height
        ,CurrencyID
        ,ActiveView360
        ,ManufacturerWarranty
        ,ModifiedBy
        ,YandexTypePrefix
        ,YandexModel
        ,BarCode
        ,Bid
        ,AccrueBonuses
        ,TaxId
        ,PaymentSubjectType
        ,PaymentMethodType
        ,YandexSizeUnit
        ,YandexName
        ,YandexDeliveryDays
        ,CreatedBy
        ,Hidden
        )
    VALUES
        (@ArtNo
        ,@Name
        ,@Ratio
        ,@Discount
        ,@DiscountAmount
        ,@Weight
        ,@BriefDescription
        ,@Description
        ,@Enabled
        ,@DateModified
        ,@DateModified
        ,@Recomended
        ,@New
        ,@BestSeller
        ,@OnSale
        ,@BrandID
        ,@AllowPreOrder
        ,@UrlPath
        ,@Unit
        ,@ShippingPrice
        ,@MinAmount
        ,@MaxAmount
        ,@Multiplicity
        ,@HasMultiOffer
        ,@SalesNote
        ,@GoogleProductCategory
        ,@YandexMarketCategory
        ,@Gtin
        ,@Adult
        ,@Length
        ,@Width
        ,@Height
        ,@CurrencyID
        ,@ActiveView360
        ,@ManufacturerWarranty
        ,@ModifiedBy
        ,@YandexTypePrefix
        ,@YandexModel
        ,@BarCode
        ,@Bid
        ,@AccrueBonuses
        ,@TaxId
        ,@PaymentSubjectType
        ,@PaymentMethodType
        ,@YandexSizeUnit
        ,@YandexName
        ,@YandexDeliveryDays
        ,@CreatedBy
        ,@Hidden
        );

    SET @ID = SCOPE_IDENTITY();
    if @ArtNo=''
    begin
        set @ArtNo = Convert(nvarchar(100),@ID)

        WHILE (SELECT COUNT(*) FROM [Catalog].[Product] WHERE [ArtNo] = @ArtNo) > 0
        begin
            SET @ArtNo = @ArtNo + '_A'
        end

        UPDATE [Catalog].[Product] SET [ArtNo] = @ArtNo WHERE [ProductID] = @ID
    end
    Select @ID
END
GO--

ALTER PROCEDURE [Catalog].[sp_UpdateProductById]
    @ProductID int,
    @ArtNo nvarchar(100),
    @Name nvarchar(255),
    @Ratio float,
    @Discount float,
    @DiscountAmount float,
    @Weight float,
    @BriefDescription nvarchar(max),
    @Description nvarchar(max),
    @Enabled bit,
    @Recomended bit,
    @New bit,
    @BestSeller bit,
    @OnSale bit,
    @BrandID int,
    @AllowPreOrder bit,
    @UrlPath nvarchar(150),
    @Unit nvarchar(50),
    @ShippingPrice money,
    @MinAmount float,
    @MaxAmount float,
    @Multiplicity float,
    @HasMultiOffer bit,
    @SalesNote nvarchar(50),
    @GoogleProductCategory nvarchar(500),
    @YandexMarketCategory nvarchar(500),
    @Gtin nvarchar(50),
    @Adult bit,
    @Length float,
    @Width float,
    @Height float,
    @CurrencyID int,
    @ActiveView360 bit,
    @ManufacturerWarranty bit,
    @ModifiedBy nvarchar(50),
    @YandexTypePrefix nvarchar(500),
    @YandexModel nvarchar(500),
    @BarCode nvarchar(50),
    @Bid float,
    @AccrueBonuses bit,
    @TaxId int,
    @PaymentSubjectType int,
    @PaymentMethodType int,
    @YandexSizeUnit nvarchar(10),
    @DateModified datetime,
    @YandexName nvarchar(255),
    @YandexDeliveryDays nvarchar(5),
    @CreatedBy nvarchar(50),
    @Hidden bit
AS
BEGIN
    UPDATE [Catalog].[Product]
    SET 
         [ArtNo] = @ArtNo
        ,[Name] = @Name
        ,[Ratio] = @Ratio
        ,[Discount] = @Discount
        ,[DiscountAmount] = @DiscountAmount
        ,[Weight] = @Weight
        ,[BriefDescription] = @BriefDescription
        ,[Description] = @Description
        ,[Enabled] = @Enabled
        ,[Recomended] = @Recomended
        ,[New] = @New
        ,[BestSeller] = @BestSeller
        ,[OnSale] = @OnSale
        ,[DateModified] = @DateModified
        ,[BrandID] = @BrandID
        ,[AllowPreOrder] = @AllowPreOrder
        ,[UrlPath] = @UrlPath
        ,[Unit] = @Unit
        ,[ShippingPrice] = @ShippingPrice
        ,[MinAmount] = @MinAmount
        ,[MaxAmount] = @MaxAmount
        ,[Multiplicity] = @Multiplicity
        ,[HasMultiOffer] = @HasMultiOffer
        ,[SalesNote] = @SalesNote
        ,[GoogleProductCategory]=@GoogleProductCategory
        ,[YandexMarketCategory]=@YandexMarketCategory
        ,[Gtin]=@Gtin
        ,[Adult] = @Adult
        ,[Length] = @Length
        ,[Width] = @Width
        ,[Height] = @Height
        ,[CurrencyID] = @CurrencyID
        ,[ActiveView360] = @ActiveView360
        ,[ManufacturerWarranty] = @ManufacturerWarranty
        ,[ModifiedBy] = @ModifiedBy
        ,[YandexTypePrefix] = @YandexTypePrefix
        ,[YandexModel] = @YandexModel
        ,[BarCode] = @BarCode
        ,[Bid] = @Bid
        ,[AccrueBonuses] = @AccrueBonuses
        ,[TaxId] = @TaxId
        ,[PaymentSubjectType] = @PaymentSubjectType
        ,[PaymentMethodType] = @PaymentMethodType
        ,[YandexSizeUnit] = @YandexSizeUnit
        ,[YandexName] = @YandexName
        ,[YandexDeliveryDays] = @YandexDeliveryDays
        ,[CreatedBy] = @CreatedBy
        ,[Hidden] = @Hidden
    WHERE ProductID = @ProductID
END
GO--

ALTER PROCEDURE [Catalog].[sp_RecalculateProductsCount]
AS
BEGIN
SET NOCOUNT ON 
;WITH cteSort AS
      (
      SELECT [Category].CategoryID AS Child,
			 [Category].ParentCategory AS Parent,
			 1  AS [Level]
        FROM [Catalog].[Category] WHERE CategoryID = 0 
      union ALL
      SELECT 
		 [Category].CategoryID AS Child,
		 [Category].ParentCategory AS Parent,
		 cteSort.[Level] + 1 AS [Level]
      FROM [Catalog].[Category] 
		   INNER JOIN cteSort ON [Category].ParentCategory = cteSort.Child and [Category].CategoryID<>0)

update c set 
   c.Products_Count=isnull(g.Products_Count,0)*c.Enabled, 
   c.Total_Products_Count=isnull(g.Total_Products_Count,0),

   c.Available_Products_Count=isnull(g.Available_Products_Count,0)*c.Enabled,
   c.Current_Products_Count=isnull(g.Current_Products_Count,0)*c.Enabled,

   c.CatLevel =cteSort.[Level]
from [Catalog].Category c
left join (
   select 
      pc.CategoryID, 
      SUM(1*p.Enabled*~p.Hidden) Products_Count,
      COUNT(*) Total_Products_Count,
	  SUM(1*p.Enabled*~p.Hidden*pExt.AmountSort) Available_Products_Count,
	  SUM(1*p.Enabled*~p.Hidden) Current_Products_Count
   from [Catalog].ProductCategories pc 
   inner join [Catalog].Product p on p.ProductID=pc.ProductID
   inner join [Catalog].[ProductExt] pExt on p.ProductID=pExt.ProductID
   --where for some conditions
   group by pc.CategoryID
   )g on g.CategoryID=c.CategoryID
left join cteSort on cteSort.Child = c.[CategoryID]

declare @max int
set @max = (select top(1) CatLevel from [Catalog].[Category] order by CatLevel  Desc)
 while (@max >0)
 begin
     UPDATE t1
		SET t1.Products_Count = t1.Products_Count + t2.pc,
		t1.Total_Products_Count = t1.Total_Products_Count + t2.tpc,

		t1.Available_Products_Count = t1.Available_Products_Count + t2.apc
		--t1.Current_Products_Count = t1.Current_Products_Count + t2.atpc

		from [Catalog].[Category] as t1 
		cross apply (Select COALESCE(SUM(Products_Count),0) pc,
							COALESCE(SUM(Total_Products_Count),0) tpc,
							COALESCE(SUM(Available_Products_Count),0) apc
							--COALESCE(SUM(Avalible_Total_Products_Count),0) atpc
							from [Catalog].[Category] where ParentCategory =t1.CategoryID) t2
							where t1.CategoryID in (Select CategoryID from [Catalog].[Category] where CatLevel =@max)
     Set @max = @max -1
 end
END
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Settings.AddEdit301RedCtrl.ErrorToManyRed', 'Запись не была добавлена. Добавление данной записи может вызвать зацикливание. Исправьте запись и попробуйте ещё раз. <a href="https://www.advantshop.net/help/pages/robots-txt#a11" target="_blank">Подробнее</a>')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Settings.AddEdit301RedCtrl.ErrorToManyRed', 'Record was not added. Adding this record can error too many redirects. Correct the record and try again. <a href="https://www.advantshop.net/help/pages/robots-txt#a11" target="_blank">More info</a>')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Settings.Import301RedCtrl.ErrorToManyRed', 'Запись не была добавлена. Добавление записи может вызвать зацикливание. Строка : {0}')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Settings.Import301RedCtrl.ErrorToManyRed', 'Record was not added. Adding record can error too many redirects. Row : {0}')

GO--

ALTER TABLE [Order].[Order] ADD IsSendedToGA bit NULL
GO--
ALTER TABLE [Order].[Order] ADD CONSTRAINT DF_Order_IsSendedToGA DEFAULT ((0)) FOR IsSendedToGA
GO--
UPDATE [Order].[Order] SET IsSendedToGA = 0
GO--
ALTER TABLE [Order].[Order] ALTER COLUMN IsSendedToGA bit NOT NULL
GO--


INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Leads.CrmNavMenu.ControlLeads','Управление списками')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Leads.CrmNavMenu.ControlLeads','Control lists')

GO--

ALTER TABLE [Catalog].[ProductGifts] ADD ProductCount int NULL
GO--
UPDATE [Catalog].[ProductGifts] SET ProductCount = 1
GO--
ALTER TABLE [Catalog].[ProductGifts] ALTER COLUMN ProductCount int NOT NULL
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OrderAnalysis.Orders', 'Заказы')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OrderAnalysis.Orders', 'Orders')

GO--



INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ProgressData.CurrentProcess','Текущий процесс')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ProgressData.CurrentProcess','Current process')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ProgressData.DataExportedSuccessfully','Данные успешно экспортированы.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ProgressData.DataExportedSuccessfully','Data exported successfully.')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ProgressData.DownloadFile','Скачать файл')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ProgressData.DownloadFile','Download file')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ProgressData.ReturnToExport','Вернуться к экспорту')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ProgressData.ReturnToExport','Return to export')

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.ProgressData.Export', 'Экспортировать');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.ProgressData.Export', 'Export');

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.Customers', 'Покупатели');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.Customers', 'Customers');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.TopCustomers', 'ТОП покупателей');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.TopCustomers', 'Top Customers');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.Fio', 'Имя');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.Fio', 'Name');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.PaidOrdersCount', 'Оплачено заказов');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.PaidOrdersCount', 'Paid orders');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.PaidOrdersSum', 'Сумма оплаченных заказов');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.PaidOrdersSum', 'Sum paid orders');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.RFM.CustomerGroups', 'Группы покупателей');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.RFM.CustomerGroups', 'Customers groups');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1,'Admin.Js.AbcxyzAnalysis.Goods', 'Товары');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2,'Admin.Js.AbcxyzAnalysis.Goods', 'Goods');

GO--

Update [Settings].[Localization] Set [ResourceValue] = 'Лиды' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Crm' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Leads' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Crm' and [LanguageId] = 2

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Store', 'Интернет-магазин'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Store', 'Online store'); 

Update [Settings].[Localization] Set [ResourceValue] = 'Воронки продаж' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Landing' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Sales funnels' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Landing' and [LanguageId] = 2

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Triggers', 'Триггерный маркетинг'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Triggers', 'Triggers'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Yandex', 'Яндекс.Маркет'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Yandex', 'Yandex.Market'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Avito', 'Avito'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Avito', 'Avito'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Google', 'Google Merchant Center'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Google', 'Google Merchant Center'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Vk', 'ВКонтакте'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Vk', 'VK'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Instagram', 'Instagram'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Instagram', 'Instagram'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Facebook', 'Facebook'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Facebook', 'Facebook'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Analytics', 'Отчеты'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Analytics', 'Analytics'); 

Update [Settings].[Localization] Set [ResourceValue] = 'Отчеты' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Marketing' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Analytics' Where [ResourceKey] = 'Core.Customers.RoleActionCategory.Marketing' and [LanguageId] = 2

GO--

If not exists (Select 1 from [Customers].[CustomerRoleAction] where RoleActionKey = 'Store')
	Insert Into [Customers].[CustomerRoleAction] (CustomerId, RoleActionKey, Enabled) 
		Select CustomerId, 'Store', Enabled 
		From [Customers].[CustomerRoleAction] 
		Where [RoleActionKey] = 'Cms' or [RoleActionKey] = 'Design' and not exists (select 1 from [Customers].[CustomerRoleAction] as cra where cra.CustomerId = CustomerId and cra.RoleActionKey = 'Store')

GO--

Delete from [Customers].[CustomerRoleAction] Where [RoleActionKey] = 'Cms' or [RoleActionKey] = 'Design'

GO--

If not exists (Select 1 from [Customers].[CustomerRoleAction] where RoleActionKey = 'Yandex')
	Insert Into [Customers].[CustomerRoleAction] (CustomerId, RoleActionKey, Enabled) 
		select CustomerId, 'Yandex', Enabled from [Customers].[CustomerRoleAction] where RoleActionKey = 'Catalog'
	
If not exists (Select 1 from [Customers].[CustomerRoleAction] where RoleActionKey = 'Avito')
	Insert Into [Customers].[CustomerRoleAction] (CustomerId, RoleActionKey, Enabled) 
		select CustomerId, 'Avito', Enabled from [Customers].[CustomerRoleAction] where RoleActionKey = 'Catalog'

If not exists (Select 1 from [Customers].[CustomerRoleAction] where RoleActionKey = 'Google')		
	Insert Into [Customers].[CustomerRoleAction] (CustomerId, RoleActionKey, Enabled) 
		select CustomerId, 'Google', Enabled from [Customers].[CustomerRoleAction] where RoleActionKey = 'Catalog'

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Ok', 'Одноклассники'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Ok', 'Ok.ru'); 

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Telegram', 'Telegram'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Telegram', 'Telegram');

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Customers.RoleActionCategory.Reseller', 'Партнерская программа'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Customers.RoleActionCategory.Reseller', 'Reseller');

GO--


CREATE TABLE [CRM].[SalesFunnel_LeadAutoCompleteProduct](
	[SalesFunnelId] [int] NOT NULL,
	[ProductId] [int] NOT NULL,
 CONSTRAINT [PK_SalesFunnel_LeadAutoCompleteProduct] PRIMARY KEY CLUSTERED 
(
	[SalesFunnelId] ASC,
	[ProductId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO--

ALTER TABLE [CRM].[SalesFunnel_LeadAutoCompleteProduct]  WITH CHECK ADD  CONSTRAINT [FK_SalesFunnel_LeadAutoCompleteProduct_Product] FOREIGN KEY([ProductId])
REFERENCES [Catalog].[Product] ([ProductId])
ON DELETE CASCADE
GO--

ALTER TABLE [CRM].[SalesFunnel_LeadAutoCompleteProduct]  WITH CHECK ADD  CONSTRAINT [FK_SalesFunnel_LeadAutoCompleteProduct_SalesFunnel] FOREIGN KEY([SalesFunnelId])
REFERENCES [CRM].[SalesFunnel] ([Id])
ON DELETE CASCADE
GO--

CREATE TABLE [CRM].[SalesFunnel_LeadAutoCompleteCategory](
	[SalesFunnelId] [int] NOT NULL,
	[CategoryId] [int] NOT NULL,
 CONSTRAINT [PK_SalesFunnel_LeadAutoCompleteCategory] PRIMARY KEY CLUSTERED 
(
	[SalesFunnelId] ASC,
	[CategoryId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO--

ALTER TABLE [CRM].[SalesFunnel_LeadAutoCompleteCategory]  WITH CHECK ADD  CONSTRAINT [FK_SalesFunnel_LeadAutoCompleteCategory_Category] FOREIGN KEY([CategoryId])
REFERENCES [Catalog].[Category] ([CategoryId])
ON DELETE CASCADE
GO--

ALTER TABLE [CRM].[SalesFunnel_LeadAutoCompleteCategory]  WITH CHECK ADD  CONSTRAINT [FK_SalesFunnel_LeadAutoCompleteCategory_SalesFunnel] FOREIGN KEY([SalesFunnelId])
REFERENCES [CRM].[SalesFunnel] ([Id])
ON DELETE CASCADE
GO--

ALTER TABLE [CRM].[SalesFunnel] ADD LeadAutoCompleteActionType int NULL
GO--
UPDATE [CRM].[SalesFunnel] SET LeadAutoCompleteActionType = 0
GO--
ALTER TABLE [CRM].[SalesFunnel] ALTER COLUMN LeadAutoCompleteActionType int NOT NULL
GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.Catalog.Color', 'Цвет'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.Catalog.Color', 'Color');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.Catalog.Size', 'Размер'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.Catalog.Size', 'Size');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.Catalog.Property', 'Свойство'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.Catalog.Property', 'Property');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.Catalog.PropertyValue', 'Значение свойства'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.Catalog.PropertyValue', 'Property value');

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.ChangeHistories.LeadsHistory.AttachmentAdded', 'Прикреплен файл'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.ChangeHistories.LeadsHistory.AttachmentAdded', 'Attachment added');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.ChangeHistories.LeadsHistory.AttachmentRemoved', 'Файл откреплен'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.ChangeHistories.LeadsHistory.AttachmentRemoved', 'Attachment removed');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Crm.Task.Attachment', 'Прикрепленные файлы'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Crm.Task.Attachment', 'Attachment');

GO--

IF NOT EXISTS (SELECT * FROM Settings.Settings WHERE Name = 'SettingsThankYouPage.NameOfBlockProducts')
BEGIN
	INSERT INTO Settings.Settings (Name, Value) VALUES ('SettingsThankYouPage.NameOfBlockProducts', 'Вас также могут заинтересовать')
END

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.CustomerSegments.Index.Segments', 'Сегменты'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.CustomerSegments.Index.Segments', 'Segments');

GO--

Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Js.TaskGrid.Result', 'Результат'); 
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Js.TaskGrid.Result', 'Result');

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.SettingsCoupons.Title', 'Скидки, купоны, сертификаты')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.SettingsCoupons.Title', 'Discounts, coupons, certificates')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.SettingsCoupons.Index.DiscountsPriceRangeTitle', 'Скидки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.SettingsCoupons.Index.DiscountsPriceRangeTitle', 'Discounts')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.SettingsCoupons.Coupons.GeneratedCoupon', 'Сгенерированные купоны')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.SettingsCoupons.Coupons.GeneratedCoupon', 'Generated coupon')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.SettingsCoupons.Coupons.PartnersCoupon', 'Купоны партнеров')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.SettingsCoupons.Coupons.PartnersCoupon', 'Partners coupons')

GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'PartnersRegistration_LegalEntityDescription'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('PartnersRegistration_LegalEntityDescription', 'Регистрация партнера. Условия работы юридического лица', '', getdate(), getdate(), 1)
END

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'PartnersRegistration_NaturalPersonDescription'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('PartnersRegistration_NaturalPersonDescription', 'Регистрация партнера. Условия работы физического лица', '', getdate(), getdate(), 1)
END
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OrderItemsSummary.AddCoupon', 'Добавить купон')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OrderItemsSummary.AddCoupon', 'Add coupon')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OrderItemsSummary.CouponCode', 'Код купона')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OrderItemsSummary.CouponCode', 'Coupon сode')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OrderItemsSummary.RemoveCoupon', 'Удалить купон')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OrderItemsSummary.RemoveCoupon', 'Remove сoupon')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Order.CouponSaved', 'Купон сохранен')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Order.CouponSaved', 'Coupon saved')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Order.CouponSavingError', 'Ошибка сожранения купона')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Order.CouponSavingError', 'Coupon saving error')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Order.CouponRemoved', 'Купон удален')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Order.CouponRemoved', 'Coupon removed')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Order.CouponRemoveError', 'Ошибка удаления купона')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Order.CouponRemoveError', 'Coupon remove error')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.MainPageProducts.CatalogLeftMenu.Title', 'Товары на главной')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.MainPageProducts.CatalogLeftMenu.Title', 'Main page products')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.EditMainPageList.ShowOnMainPage', 'Показывать на главной')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.EditMainPageList.ShowOnMainPage', 'Show on main page')

GO--

INSERT INTO [Settings].[Settings] ([Name], [Value]) Values ('ShowBestOnMainPage', 'True') 
INSERT INTO [Settings].[Settings] ([Name], [Value]) Values ('ShowNewOnMainPage', 'True') 
INSERT INTO [Settings].[Settings] ([Name], [Value]) Values ('ShowSalesOnMainPage', 'True') 

GO--

ALTER TABLE [Booking].[Booking] ADD
	[BookingDiscount] [float] NULL,
	[BookingDiscountValue] [float] NULL,
	[DiscountCost] [float] NULL,
	[PaymentDate] [datetime] NULL,
	[PaymentCost] [float] NULL,
	[PaymentMethodID] [int] NULL,
	[ArchivedPaymentName] [nvarchar](255) NULL

GO--

ALTER TABLE [Booking].[Booking]  WITH CHECK ADD  CONSTRAINT [FK_Booking_PaymentMethod] FOREIGN KEY([PaymentMethodID])
REFERENCES [Order].[PaymentMethod] ([PaymentMethodID])
ON DELETE SET NULL

GO--

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Booking.Booking.BookingDiscount', 'Скидка')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Booking.Booking.BookingDiscount', 'Discount')
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Booking.Booking.BookingDiscountValue', 'Скидка');
Insert into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Booking.Booking.BookingDiscountValue', 'Discount');
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Booking.Booking.PaymentDate', 'Дата оплаты')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Booking.Booking.PaymentDate', 'Payment date')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Booking.Booking.PaymentCost', 'Стоимость оплаты')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Booking.Booking.PaymentCost', 'Payment cost')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Core.Booking.Booking.PaymentName', 'Метод оплаты')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Core.Booking.Booking.PaymentName', 'Payment method')

GO--

UPDATE [Partners].[Partner] SET FirstName = ISNULL(LastName + ' ', '') + FirstName + ISNULL(' ' + Patronymic, '')
EXEC sp_rename 'Partners.Partner.FirstName', 'Name', 'COLUMN'
GO--
ALTER TABLE [Partners].[Partner] DROP COLUMN LastName
ALTER TABLE [Partners].[Partner] DROP COLUMN Patronymic
GO--
ALTER TABLE [Partners].[Partner] ALTER COLUMN Name nvarchar(250)
GO--
ALTER TABLE [Partners].[NaturalPerson] ADD PaymentTypeId int NULL, PaymentAccountNumber nvarchar(250) NULL
GO--
UPDATE [Partners].[NaturalPerson] SET 
	PaymentTypeId = (SELECT PaymentTypeId FROM [Partners].[Partner] WHERE Id = NaturalPerson.PartnerId),
	PaymentAccountNumber = (SELECT PaymentAccountNumber FROM [Partners].[Partner] WHERE Id = NaturalPerson.PartnerId)
ALTER TABLE [Partners].[Partner] DROP CONSTRAINT FK_Partner_PaymentType
ALTER TABLE [Partners].[Partner] DROP COLUMN PaymentTypeId
ALTER TABLE [Partners].[Partner] DROP COLUMN PaymentAccountNumber
GO--


Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Common', 'Основные')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Common', 'Common')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MainPage', 'Главная')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MainPage', 'Main page')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Catalog', 'Категория товаров')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Catalog', 'Category')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Product', 'Карточка товара')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Product', 'Product')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Checkout', 'Оформление заказа')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Checkout', 'Checkout')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Other', 'Прочее')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Other', 'Others')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CssEditor', 'CSS')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CssEditor', 'CSS')


Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MainPageModeTitle', 'Режим отображения главной страницы')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MainPageModeTitle', 'Main page display mode')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MenuStyleTitle', 'Стиль отображения меню')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MenuStyleTitle', 'Menu display mode')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MenuStyleHint', 'Определяет, как будет отображаться меню каталога')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MenuStyleHint', 'Catalog menu style')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.SearchBlockLocationTitle', 'Расположение поиска')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.SearchBlockLocationTitle', 'Search block location')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.RecentlyViewVisibilityTitle', 'Вы уже смотрели')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.RecentlyViewVisibilityTitle', 'Recently views')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.WishListVisibilityTitle', 'Cписок желаний')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.WishListVisibilityTitle', 'Wish list')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselVisibilityTitle', 'Отображать карусель на главной')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselVisibilityTitle', 'Show carousel on the main page')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselVisibilityHint', 'Показывать слайдер на главной странице или нет')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselVisibilityHint', 'Show carousel slider on main page')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselAnimationSpeedTitle', 'Скорость анимации')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselAnimationSpeedTitle', 'Animation speed')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselAnimationSpeedHint', 'Скорость перелистывания слайда карусели в милисекундах. Рекомендуемые значения 200-1000')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselAnimationSpeedHint', 'The speed of the turning slide carousel, in milliseconds. Recommended values 200-1000')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselAnimationDelayTitle', 'Пауза')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselAnimationDelayTitle', 'Delay')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CarouselAnimationDelayHint', 'Частота перелистывания слайдов карусели. Рекомендуемые значения 5000-10000')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CarouselAnimationDelayHint', 'The frequency of turning slide carousel. Recommended values 5000-10000')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MainPageProductsVisibilityTitle', 'Отображать товары на главной')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MainPageProductsVisibilityTitle', 'Display products on main page')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CountMainPageProductInSectionTitle', 'Количество товаров в блоке')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CountMainPageProductInSectionTitle', 'Products count in block')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CountMainPageProductInLineTitle', 'Количество товаров в строке')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CountMainPageProductInLineTitle', 'Products count in line')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.BrandCarouselVisibilityTitle', 'Карусель производителей на главной')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.BrandCarouselVisibilityTitle', 'Brands carousel on main page')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.NewsVisibilityTitle', 'Новости')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.NewsVisibilityTitle', 'News')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.NewsSubscriptionVisibilityTitle', 'Подписка на новости')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.NewsSubscriptionVisibilityTitle', 'News subscribe')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CheckOrderVisibilityTitle', 'Проверка статуса заказа')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CheckOrderVisibilityTitle', 'Check order status')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.VotingVisibilityTitle', 'Голосование')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.VotingVisibilityTitle', 'Show voting block')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.GiftSertificateVisibilityTitle', 'Блок подарочных сертификатов')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.GiftSertificateVisibilityTitle', 'Gift certificates block')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CountCategoriesInLineTitle', 'Количество категорий в строке')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CountCategoriesInLineTitle', 'Count of categories in row')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.CountCatalogProductInLineTitle', 'Количество товаров в строке')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.CountCatalogProductInLineTitle', 'Products count in line')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.BigProductImage', 'Товар. Большая фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.BigProductImage', 'Product. Big photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Width', 'Ширина')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Width', 'Width')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Height', 'Высота')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Height', 'Height')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.MiddleProductImage', 'Товар. Средняя фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.MiddleProductImage', 'Product. Middle photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.SmallProductImage', 'Товар. Маленькая фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.SmallProductImage', 'Product. Small photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.XSmallProductImage', 'Товар. Самая маленькая фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.XSmallProductImage', 'Product. Smallest photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.BigCategoryImage', 'Категория. Большая фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.BigCategoryImage', 'Category. Big photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.SmallCategoryImage', 'Категория. Маленькая фотография')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.SmallCategoryImage', 'Category. Small photo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.PaymentIcon', 'Иконки для оплаты')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.PaymentIcon', 'Payment icons')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.ShippingIcon', 'Иконки для доставки')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.ShippingIcon', 'Shipping icons')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.BrandLogo', 'Лого производителя')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.BrandLogo', 'Brand logo')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.NewsImage', 'Изображение новости')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.NewsImage', 'News picture')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Settings.Template.Title', 'Настройки шаблона')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Settings.Template.Title', 'Template setting')

Update [Settings].[Localization] Set [ResourceValue] = 'Тема' Where [ResourceKey] = 'Admin.Design.Index.Theme' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Theme' Where [ResourceKey] = 'Admin.Design.Index.Theme' and [LanguageId] = 2

Update [Settings].[Localization] Set [ResourceValue] = 'Фон' Where [ResourceKey] = 'Admin.Design.Index.Background' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Background' Where [ResourceKey] = 'Admin.Design.Index.Background' and [LanguageId] = 2

Update [Settings].[Localization] Set [ResourceValue] = 'Цветовая схема' Where [ResourceKey] = 'Admin.Design.Index.ColorScheme' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Color scheme' Where [ResourceKey] = 'Admin.Design.Index.ColorScheme' and [LanguageId] = 2

Update [Settings].[Localization] Set [ResourceValue] = 'Количество товаров на странице' Where [ResourceKey] = 'Admin.Settings.Catalog.ProductsPerPage' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Count of products in page' Where [ResourceKey] = 'Admin.Settings.Catalog.ProductsPerPage' and [LanguageId] = 2

GO--

If not Exists(Select 1 From sys.columns WHERE Name = N'ButtonTextBold' AND Object_ID = Object_ID(N'CMS.LandingColorScheme'))
Begin
    ALTER TABLE CMS.LandingColorScheme ADD
		ButtonTextBold nvarchar(30) NULL
End

GO--

If not Exists(Select 1 From sys.columns WHERE Name = N'ButtonSecondaryTextBold' AND Object_ID = Object_ID(N'CMS.LandingColorScheme'))
Begin
    ALTER TABLE CMS.LandingColorScheme ADD
		ButtonSecondaryTextBold nvarchar(30) NULL
End

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.TemplatesDocx.TemplateDocxType.Order','Заказ')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.TemplatesDocx.TemplateDocxType.Order','Order')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Shippingsmethods','Доставка')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Shippingsmethods','Shippings methods')

Update [Settings].[Localization] Set [ResourceValue] = 'Свойства' Where [ResourceKey] = 'Admin.Properties.Index.Title' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Режим цен' Where [ResourceKey] = 'Admin.Settings.Catalog.DisplayModeOfPrices' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Mode of prices' Where [ResourceKey] = 'Admin.Settings.Catalog.DisplayModeOfPrices' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Общие' Where [ResourceKey] = 'Admin.Settings.Checkout.Common' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Common' Where [ResourceKey] = 'Admin.Settings.Checkout.Common' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Статусы' Where [ResourceKey] = 'Admin.OrderStatuses.Index.Title' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Statuses' Where [ResourceKey] = 'Admin.OrderStatuses.Index.Title' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Поля в оформлении' Where [ResourceKey] = 'Admin.Settings.Checkout.CheckoutFields' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Источники' Where [ResourceKey] = 'Admin.OrderSources.Index.Title' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Sources' Where [ResourceKey] = 'Admin.OrderSources.Index.Title' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Налог' Where [ResourceKey] = 'Admin.Settings.Checkout.Taxes' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Tax' Where [ResourceKey] = 'Admin.Settings.Checkout.Taxes' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Выгрузка' Where [ResourceKey] = 'Admin.Analytics.ExportOrders.Title' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Export' Where [ResourceKey] = 'Admin.Analytics.ExportOrders.Title' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Настройки' Where [ResourceKey] = 'Admin.Settings.Users.Settings' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Активность' Where [ResourceKey] = 'Admin.Settings.SystemSettings.AppsTasksActive' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Active' Where [ResourceKey] = 'Admin.Settings.SystemSettings.AppsTasksActive' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Активность' Where [ResourceKey] = 'Admin.Settings.SystemSettings.AppsBookingActive' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Active' Where [ResourceKey] = 'Admin.Settings.SystemSettings.AppsBookingActive' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceValue] = 'Активность' Where [ResourceKey] = 'Admin.SettingsBonus.Index.Enable' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceValue] = 'Active' Where [ResourceKey] = 'Admin.SettingsBonus.Index.Enable' and [LanguageId] = 2


GO--

Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Triggers.Index.Triggers' Where [ResourceKey] = 'Admin.Triggers.NavMenu.Triggers' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Triggers.Index.Triggers' Where [ResourceKey] = 'Admin.Triggers.NavMenu.Triggers' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Triggers.Index.Categories' Where [ResourceKey] = 'Admin.Triggers.NavMenu.Categories' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Triggers.Index.Categories' Where [ResourceKey] = 'Admin.Triggers.NavMenu.Categories' and [LanguageId] = 2

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Design.TemplateShop.Title','Магазин шаблонов дизайна')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Design.TemplateShop.Title','Template shop')

GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_Customers_TopBlock'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_Customers_TopBlock', 'ЛК партнера. Описание на странице со списком клиентов', '', getdate(), getdate(), 1)
END
GO--

ALTER TABLE [Partners].[BindedCustomer] ADD Url nvarchar(500) NULL, CouponCode nvarchar(50) NULL, Enabled bit NULL
GO--
UPDATE [Partners].[BindedCustomer] SET Enabled = 1
GO-- 
ALTER TABLE [Partners].[BindedCustomer] ALTER COLUMN Enabled bit NOT NULL
GO--
ALTER TABLE [Partners].[Transaction] ADD DetailsJson nvarchar(max) NULL
GO--


Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Analytics.Emailing', 'Email рассылки')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Analytics.Emailing', 'Email mailing')

Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (1, 'Admin.Analytics.SearchRequests', 'Поисковые запросы')
Insert Into [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) Values (2, 'Admin.Analytics.SearchRequests', 'Searches')

INSERT INTO [Settings].[Localization] ([LanguageId], [ResourceKey], [ResourceValue]) VALUES (1, 'Admin.Js.ManualEmailings.WithoutEmailing.Title', 'Аналитика транзакционных писем')
INSERT INTO [Settings].[Localization] ([LanguageId], [ResourceKey], [ResourceValue]) VALUES (2, 'Admin.Js.ManualEmailings.WithoutEmailing.Title', 'Analytics transaction emails')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.ManualEmailings.Title', 'Аналитика email рассылок')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.ManualEmailings.Title', 'Manual emailings analytics')

GO--

UPDATE [CMS].[TemplatesDocx]
   SET [FileName] = CONVERT(nvarchar, [Id]) + Substring([FileName], len([FileName]) - Charindex('.', Reverse([FileName])) + 1, Charindex('.', Reverse([FileName])))

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Template.SocialWidget', 'Виджет коммуникаций')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Template.SocialWidget', 'Social widget')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Template.SocialWidget.Help', 'Что такое виджет коммуникаций?')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Template.SocialWidget.Help', 'What social widget is?')

Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.Title' Where [ResourceKey] = 'Admin.Settings.Social.SocialWidget' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.Title' Where [ResourceKey] = 'Admin.Settings.Social.SocialWidget' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowCommunicationWidget' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowCommunicationWidget' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowCommunicationWidget' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowCommunicationWidget' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowVkontakte' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowVkontakte' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowVkontakte' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowVkontakte' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfIntegrationIsConfigured' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfIntegrationIsConfigured' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfIntegrationIsConfigured' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfIntegrationIsConfigured' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowFaceBook' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowFaceBook' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowFaceBook' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowFaceBook' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowJivosite' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowJivosite ' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowJivosite' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowJivosite ' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfJivositeModuleIsConnected' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfJivositeModuleIsConnected' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfJivositeModuleIsConnected' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfJivositeModuleIsConnected' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowCallback' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowCallback' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowCallback' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowCallback' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfCallBackModuleIsConnected' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfCallBackModuleIsConnected' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.IfCallBackModuleIsConnected' Where [ResourceKey] = 'Admin.SettingsCrm.Index.IfCallBackModuleIsConnected' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowWhatsApp' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowWhatsApp' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowWhatsApp' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowWhatsApp' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowViber' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowViber' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowViber' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowViber' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowOdnoklassniki' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowOdnoklassniki' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowOdnoklassniki' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowOdnoklassniki' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowTelegram' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowTelegram' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.ShowTelegram' Where [ResourceKey] = 'Admin.SettingsCrm.Index.ShowTelegram' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.Name' Where [ResourceKey] = 'Admin.SettingsCrm.Index.Name' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.Name' Where [ResourceKey] = 'Admin.SettingsCrm.Index.Name' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.UrlAddressOfLink' Where [ResourceKey] = 'Admin.SettingsCrm.Index.UrlAddressOfLink' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.UrlAddressOfLink' Where [ResourceKey] = 'Admin.SettingsCrm.Index.UrlAddressOfLink' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget1' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget1' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget1' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget1' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget2' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget2' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget2' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget2' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget3' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget3' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.CustomWidget3' Where [ResourceKey] = 'Admin.SettingsCrm.Index.CustomWidget3' and [LanguageId] = 2
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.WhatsApp.HelpText' Where [ResourceKey] = 'Admin.SettingsCrm.Index.WhatsApp.HelpText' and [LanguageId] = 1
Update [Settings].[Localization] Set [ResourceKey] = 'Admin.Settings.Template.SocialWidget.WhatsApp.HelpText' Where [ResourceKey] = 'Admin.SettingsCrm.Index.WhatsApp.HelpText' and [LanguageId] = 2

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Design.Index.Domain', 'Домен магазина')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Design.Index.Domain', 'Shop domain')

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Цена' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Admin.Design.Index.Price'
UPDATE [Settings].[Localization] SET [ResourceValue] = 'Price' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Admin.Design.Index.Price'

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Design.Index.GoTemplateShop', 'Перейти в магазин шаблонов')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Design.Index.GoTemplateShop', 'Visit theme store')

GO--

ALTER TABLE [Partners].[BindedCustomer] ADD VisitDate dateTime NULL
GO--


IF (NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'Order' AND  TABLE_NAME = 'ShippingRegion'))
BEGIN
	CREATE TABLE [Order].[ShippingRegion](
		[MethodId] [int] NOT NULL,
		[RegionId] [int] NOT NULL,
	 CONSTRAINT [PK_ShippingRegion] PRIMARY KEY CLUSTERED 
	(
		[MethodId] ASC,
		[RegionId] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'Order.FK_ShippingRegion_Region') AND parent_object_id = OBJECT_ID(N'Order.ShippingRegion')
)
BEGIN

	ALTER TABLE [Order].[ShippingRegion]  WITH CHECK ADD  CONSTRAINT [FK_ShippingRegion_Region] FOREIGN KEY([RegionId])
	REFERENCES [Customers].[Region] ([RegionID])
	ON UPDATE CASCADE
	ON DELETE CASCADE


	ALTER TABLE [Order].[ShippingRegion] CHECK CONSTRAINT [FK_ShippingRegion_Region]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'Order.FK_ShippingRegion_ShippingMethod') AND parent_object_id = OBJECT_ID(N'Order.ShippingRegion')
)
BEGIN

	ALTER TABLE [Order].[ShippingRegion]  WITH CHECK ADD  CONSTRAINT [FK_ShippingRegion_ShippingMethod] FOREIGN KEY([MethodId])
	REFERENCES [Order].[ShippingMethod] ([ShippingMethodID])
	ON UPDATE CASCADE
	ON DELETE CASCADE

	ALTER TABLE [Order].[ShippingRegion] CHECK CONSTRAINT [FK_ShippingRegion_ShippingMethod]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name='ShippingRegion_RegionId' AND object_id = OBJECT_ID('Order.ShippingRegion')
)
BEGIN
	CREATE NONCLUSTERED INDEX [ShippingRegion_RegionId] ON [Order].[ShippingRegion]
	(
		[RegionId] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
END

GO--

IF (NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'Order' AND  TABLE_NAME = 'ShippingRegionExcluded'))
BEGIN
	CREATE TABLE [Order].[ShippingRegionExcluded](
		[MethodId] [int] NOT NULL,
		[RegionId] [int] NOT NULL,
	 CONSTRAINT [PK_ShippingRegionExcluded] PRIMARY KEY CLUSTERED 
	(
		[MethodId] ASC,
		[RegionId] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'Order.FK_ShippingRegionExcluded_Region') AND parent_object_id = OBJECT_ID(N'Order.ShippingRegionExcluded')
)
BEGIN
	ALTER TABLE [Order].[ShippingRegionExcluded]  WITH CHECK ADD  CONSTRAINT [FK_ShippingRegionExcluded_Region] FOREIGN KEY([RegionId])
	REFERENCES [Customers].[Region] ([RegionID])
	ON UPDATE CASCADE
	ON DELETE CASCADE

	ALTER TABLE [Order].[ShippingRegionExcluded] CHECK CONSTRAINT [FK_ShippingRegionExcluded_Region]
END

GO--


IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'Order.FK_ShippingRegionExcluded_ShippingMethod') AND parent_object_id = OBJECT_ID(N'Order.ShippingRegionExcluded')
)
BEGIN
	ALTER TABLE [Order].[ShippingRegionExcluded]  WITH CHECK ADD  CONSTRAINT [FK_ShippingRegionExcluded_ShippingMethod] FOREIGN KEY([MethodId])
	REFERENCES [Order].[ShippingMethod] ([ShippingMethodID])
	ON UPDATE CASCADE
	ON DELETE CASCADE

	ALTER TABLE [Order].[ShippingRegionExcluded] CHECK CONSTRAINT [FK_ShippingRegionExcluded_ShippingMethod]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name='ShippingRegionExcluded_RegionId' AND object_id = OBJECT_ID('Order.ShippingRegionExcluded')
)
BEGIN
	CREATE NONCLUSTERED INDEX [ShippingRegionExcluded_RegionId] ON [Order].[ShippingRegionExcluded]
	(
		[RegionId] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
END

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Triggers.Triggers', 'Триггеры')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Triggers.Triggers', 'Triggers')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Resellers', 'Реселлеры')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Resellers', 'Resellers')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Resellers.Description', 'Продавайте через партнеров. Cоздавайте собственную сеть интернет-магазинов, перепродающих вашу продукцию, с помощью нового канала продаж.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Resellers.Description', 'Sell through partners. Create your own network of online stores that resell your products using a new sales channel.')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Checkout.CrossSellFunnels', 'Воронки допродаж')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Checkout.CrossSellFunnels', 'Cross-sell funnels')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Checkout.ShowCrossSellFunnels', 'Показывать воронку допродаж')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Checkout.ShowCrossSellFunnels', 'Show cross-sell funnel')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'AdvantShop.Core.SettingsLandingPage.ECrossSellShowMode.ProductNotInCart', 'Если товара допродаж еще нет в корзине')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'AdvantShop.Core.SettingsLandingPage.ECrossSellShowMode.ProductNotInCart', 'If cross-sell product are not yet in shopping cart')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'AdvantShop.Core.SettingsLandingPage.ECrossSellShowMode.Always', 'Всегда')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'AdvantShop.Core.SettingsLandingPage.ECrossSellShowMode.Always', 'Always')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Landing.Domain.LpFunnelType.QuizFunnel', 'Квиз')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Landing.Domain.LpFunnelType.QuizFunnel', 'Quiz funnel')

GO--

ALTER TABLE [Partners].[LegalEntity] ADD [Zip] nvarchar(50) NULL
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_Accruals_TopBlock'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_Accruals_TopBlock', 'ЛК партнера. Описание на странице со списком начислений', '', getdate(), getdate(), 1)
END
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_Rewards_TopBlock_LegalEntity'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_Rewards_TopBlock_LegalEntity', 'ЛК партнера. Описание на странице со списком выплат (для юр. лиц)', '', getdate(), getdate(), 1)
END
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_Rewards_TopBlock_NaturalPerson'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_Rewards_TopBlock_NaturalPerson', 'ЛК партнера. Описание на странице со списком выплат (для физ. лиц)', '', getdate(), getdate(), 1)
END
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_NoContract_LegalEntity'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_NoContract_LegalEntity', 'ЛК партнера. Блок с информацией о заключении договора (для юр. лиц)', '', getdate(), getdate(), 1)
END
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_NoContract_NaturalPerson'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_NoContract_NaturalPerson', 'ЛК партнера. Блок с информацией о заключении договора (для физ. лиц)', '', getdate(), getdate(), 1)
END
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[StaticBlock] WHERE [Key] = 'Partners_AccountBlocked'))
BEGIN
   INSERT INTO [CMS].[StaticBlock] ([Key],[InnerName],[Content],[Added],[Modified],[Enabled]) 
   VALUES ('Partners_AccountBlocked', 'ЛК партнера. Текст на странице отключенного партнера', '', getdate(), getdate(), 1)
END
GO--

IF COL_LENGTH('CMS.TemplatesDocx', 'DebugMode') IS NULL
BEGIN
	ALTER TABLE [CMS].[TemplatesDocx] ADD DebugMode bit NULL
END

GO--

ALTER TABLE CMS.LandingForm ADD
	OfferItemsJson nvarchar(MAX) NULL

GO--

IF NOT EXISTS(SELECT 1 FROM Settings.Settings WHERE Name = 'SettingsSocialWidget.ViberPhone')
BEGIN
	DECLARE @ViberLink nvarchar(max) = (SELECT top(1) Value FROM Settings.Settings WHERE Name = 'SettingsSocialWidget.LinkViber')
	IF (@ViberLink IS NOT NULL AND @ViberLink <> '' AND @ViberLink <> 'viber://pa?chatURI=<URI>' AND @ViberLink LIKE 'viber://pa?chatURI=%')
	BEGIN
		INSERT INTO [Settings].[Settings] (Name, Value) VALUES ('SettingsSocialWidget.ViberPhone', REPLACE(@ViberLink, 'viber://pa?chatURI=', ''))
	END
END
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1, 'Admin.Settings.Template.SocialWidget.Viber.HelpText', 'Укажите номер телефона в числовом формате (без "+", "-", скобок и т.п.)')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2, 'Admin.Settings.Template.SocialWidget.Viber.HelpText', 'Enter the phone number in numeric format (without "+", "-", brackets etc.)')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerRegistration')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('Регистрация партнера', 350, 
	'Письмо при регистрации партнера (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #REGDATE#, #PASSWORD#)', 
	'OnPartnerRegistration')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerRegistration'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('Регистрация партнера', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Регистрация в партнерской программе на сайте <a href="#SITEURL#">#SITEURL#</a> прошла успешно.</p>
    <p>Личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
    <div class="data" style="display: table; width: 100%;">
        <div class="data-cell" style="display: table-cell; padding: 0; padding-right: 1%;">
            <div class="o-title vi" style="font-size: 14px; font-weight: bold; margin: 5px 0;">Информация о партнере</div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">Дата регистрации:</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0;">#REGDATE#</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">Наименование/ФИО:</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0;">#NAME#</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">Ваш купон:</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0;">#COUPONCODE#</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">Процент вознаграждения:</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0;">#REWARDPERCENT#%</div>
            </div>
        </div>
    </div>
</div>', 1550, 1, GETDATE(), GETDATE(), 'Регистрация в личном кабинете партнера #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerRegistration'))
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerCustomerBinded')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('К партнеру привязан новый покупатель', 360, 
	'Письмо партнеру при привязке нового покупателя (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #BALANCE#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #CUSTOMER_EMAIL#)', 
	'OnPartnerCustomerBinded')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerCustomerBinded'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('К партнеру привязан новый покупатель', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Новый клиент закреплен за вами в личном кабинете партнера #SITENAME#</p>
    <p>Перейти в личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
    <div class="data" style="display: table; width: 100%;">
        <div class="data-cell" style="display: table-cell; padding: 0; padding-right: 1%; width: 24%;">
            <div class="o-title vi" style="font-size: 14px; font-weight: bold; margin: 5px 0;">Информация о клиенте</div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 80px; vertical-align: middle;">E-mail:</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0;">#CUSTOMER_EMAIL#</div>
            </div>
        </div>
    </div>
</div>', 1560, 1, GETDATE(), GETDATE(), 'Новый клиент закреплен за вами в личном кабинете партнера #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerCustomerBinded'))
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMoneyAdded')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('Пополнение баланса партнера', 370, 
	'Письмо партнеру при оплате заказа привязанным к нему покупателем (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #BALANCE#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #CUSTOMER_EMAIL#, #REWARD_SUM#, #PAYMENT_SUM#)', 
	'OnPartnerMoneyAdded')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMoneyAdded'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('Пополнение баланса партнера', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Начислено вознаграждение в рамках партнерской программы #SITENAME#</p>
	<p>Вам начислено партнерское вознаграждение в размере <b>#REWARD_SUM#</b> за заказ клиента #CUSTOMER_EMAIL#. Оплачено товаров на сумму <b>#PAYMENT_SUM#</b></p>
	<p>Текущий баланс: <b>#BALANCE#</b></p>
    <p>Перейти в личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
</div>', 1570, 1, GETDATE(), GETDATE(), 'Начислено вознаграждение в рамках партнерской программы #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMoneyAdded'))
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMonthReport')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('Ежемесячный отчет партнеру', 380, 
	'Ежемесячный отчет о состоянии партнерского аккаунта (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #BALANCE#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #REPORTPERIOD#, #CUSTOMERS_COUNT#, #CUSTOMERS_TOTALCOUNT#, #REWARDS_SUM#, #REWARDS_TOTALSUM#, #PAYMENTS_SUM#, #PAYMENTS_TOTALSUM#)', 
	'OnPartnerMonthReport')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMonthReport'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('Пополнение баланса партнера', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Отчет о состоянии партнерского аккаунта</p>
	<p>Текущий баланс: <b>#BALANCE#</b></p>
	<p>Процент вознаграждения: <b>#REWARDPERCENT#%</b></p>
    <div class="data" style="display: table; width: 100%;">
        <div class="data-cell" style="display: table-cell; padding: 0; padding-right: 1%;">
            <div class="l-row">
                <div class="l-name vi" style="display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;"></div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle; text-align: right;">
					За #REPORTPERIOD#
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; width: 150px; vertical-align: middle; text-align: right;">
					Всего
				</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">
					Подключено клиентов:
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle; text-align: right;">
					#CUSTOMERS_COUNT#
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; width: 150px; vertical-align: middle; text-align: right;">
					#CUSTOMERS_TOTALCOUNT#
				</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">
					Начислено:
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle; text-align: right;">
					#REWARDS_SUM#
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; width: 150px; vertical-align: middle; text-align: right;">
					#REWARDS_TOTALSUM#
				</div>
            </div>
            <div class="l-row">
                <div class="l-name vi cs-light" style="color: #acacac; display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle;">
					Платежи:
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; padding-right: 15px; width: 150px; vertical-align: middle; text-align: right;">
					#PAYMENTS_SUM#
				</div>
                <div class="l-value vi" style="display: inline-block; margin: 5px 0; width: 150px; vertical-align: middle; text-align: right;">
					#PAYMENTS_TOTALSUM#
				</div>
            </div>
        </div>
    </div>
    <p>Перейти в личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
</div>', 1580, 1, GETDATE(), GETDATE(), 'Отчет о состоянии аккаунта партнера #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerMonthReport'))
GO--

IF COL_LENGTH('Partners.Partner', 'SendMessages') IS NULL AND COL_LENGTH('Partners.Partner', 'DontSendMessages') IS NOT NULL
	EXEC sp_rename N'[Partners].[Partner].DontSendMessages', N'SendMessages', 'COLUMN' 
GO--


CREATE SCHEMA [Vk]

GO--

CREATE TABLE [Vk].[VkCategory](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[VkId] [bigint] NOT NULL,
	[VkCategoryId] [bigint] NOT NULL,
	[Name] [nvarchar](max) NOT NULL,
	[SortOrder] [int] NOT NULL,
	CONSTRAINT [PK_VkCategory] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO--

CREATE TABLE [Vk].[VkCategory_Category](
	[CategoryId] [int] NOT NULL,
	[VkCategoryId] [int] NOT NULL,
 CONSTRAINT [PK_VkCategory_Category] PRIMARY KEY CLUSTERED 
(
	[CategoryId] ASC,
	[VkCategoryId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [Vk].[VkCategory_Category]  WITH CHECK ADD  CONSTRAINT [FK_VkCategory_Category_Category] FOREIGN KEY([CategoryId])
REFERENCES [Catalog].[Category] ([CategoryID])
ON DELETE CASCADE

ALTER TABLE [Vk].[VkCategory_Category]  WITH CHECK ADD  CONSTRAINT [FK_VkCategory_Category_VkCategory] FOREIGN KEY([VkCategoryId])
REFERENCES [Vk].[VkCategory] ([Id])
ON DELETE CASCADE

ALTER TABLE [Vk].[VkCategory_Category] CHECK CONSTRAINT [FK_VkCategory_Category_VkCategory]

GO--

CREATE TABLE [Vk].[VkProduct](
	[Id] [bigint] NOT NULL,
	[ProductId] [int] NOT NULL,
	[MainPhotoId] [bigint] NOT NULL,
	[PhotoIds] [nvarchar](max) NOT NULL,
	[AlbumId] [bigint] NOT NULL,
 CONSTRAINT [PK_VkProduct] PRIMARY KEY CLUSTERED 
(
	[Id] ASC,
	[ProductId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO--

IF (EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'Module' AND  TABLE_NAME = 'VkCategory'))
BEGIN
    SET IDENTITY_INSERT [Vk].[VkCategory] ON
	Insert Into [Vk].[VkCategory] (Id,VkId,VkCategoryId,Name,SortOrder) Select Id,VkId,VkCategoryId,Name,SortOrder From [Module].[VkCategory]
	SET IDENTITY_INSERT [Vk].[VkCategory] OFF
END

GO--

IF (EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'Module' AND  TABLE_NAME = 'VkCategory_Category'))
BEGIN
	Insert Into [Vk].[VkCategory_Category] ([CategoryId],[VkCategoryId]) Select [CategoryId],[VkCategoryId] From [Module].[VkCategory_Category]
END

GO--

IF (EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'Module' AND  TABLE_NAME = 'VkProduct'))
BEGIN
	Insert Into [Vk].[VkProduct] (Id,ProductId,MainPhotoId,PhotoIds,AlbumId) Select Id,ProductId,MainPhotoId,PhotoIds,AlbumId From [Module].[VkProduct]
END

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'ExportUnavailableProducts' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'ExportUnavailableProducts')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'ExportUnavailableProducts' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'AddSizeAndColorInDescription' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'AddSizeAndColorInDescription')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'AddSizeAndColorInDescription' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'AddSizeAndColorInName' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'AddSizeAndColorInName')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'AddSizeAndColorInName' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'ShowDescription' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'ShowDescription')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'ShowDescription' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'ShowProperties' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'ShowProperties')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'ShowProperties' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'AddLinkToSite' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'AddLinkToSite')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'AddLinkToSite' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'TextBeforeLinkToSite' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'TextBeforeLinkToSite')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'TextBeforeLinkToSite' and ModuleName = 'VkMarket'
end

GO--

IF Exists (Select 1 From [Settings].[ModuleSettings] Where Name = 'CurrencyIso3' and ModuleName = 'VkMarket') and 
   not Exists (Select 1 From [Settings].[Settings] Where Name = 'CurrencyIso3')
begin
	Insert Into [Settings].[Settings] ([Name],[Value]) 
	Select Name,[Value] From [Settings].[ModuleSettings] Where Name = 'CurrencyIso3' and ModuleName = 'VkMarket'
end

GO--

IF NOT EXISTS (SELECT 1 FROM [Settings].[Settings] WHERE Name = 'Partners.DefaultRewardPercent')
BEGIN
	INSERT INTO [Settings].[Settings] (Name, Value) VALUES ('Partners.DefaultRewardPercent', '3')
END
GO--

CREATE TABLE [Partners].[PayoutReport](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](255) NOT NULL,
	[PeriodTo] [datetime] NOT NULL,
	[DateCreated] [datetime] NOT NULL,
 CONSTRAINT [PK_PayoutReport] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO--

ALTER TABLE [Partners].[Partner] DROP CONSTRAINT [FK_Partner_Coupon]
GO--

ALTER TABLE [Partners].[Partner] WITH CHECK ADD CONSTRAINT [FK_Partner_Coupon] FOREIGN KEY([CouponId])
REFERENCES [Catalog].[Coupon] ([CouponID])
ON DELETE SET NULL
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Product.LandingFunnels.InstallLandingFunnels', 'Подключить воронки продаж')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Product.LandingFunnels.InstallLandingFunnels', 'Install landing funnels')

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Сумма покупок' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.AmountOfPurchases' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Amount of purchases' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.AmountOfPurchases' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Средний чек' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.AverageCheck' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Average check' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.AverageCheck' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Входящие' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.IncomingCalls' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Incoming' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.IncomingCalls' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Исходящие' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.OutgoingCalls' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Outgoing' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.OutgoingCalls' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Писем отправлено' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.EmailsSended' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Letters sended' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.EmailsSended' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Писем получено' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.EmailsReceived' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Letters received' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.EmailsReceived' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'SMS отправлено' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.SmsSended' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'SMS sended' WHERE [ResourceKey] = 'Admin.Customers.ViewCustomerHeader.SmsSended' and [LanguageId] = 2

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Customers.ViewCustomerHeader.AmountOrders', 'Кол-во заказов')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Customers.ViewCustomerHeader.AmountOrders', 'Amount of orders')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Customers.ViewCustomerHeader.DurationDate', 'Ваш клиент')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Customers.ViewCustomerHeader.DurationDate', 'Your customer')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Customers.ViewInfo.Customer', 'Покупатель')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Customers.ViewInfo.Customer', 'Сustomer')

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = '<span class="bold">Шаг 1.</span> Создайте приложение в Вконтакте.' WHERE [ResourceKey] = 'Admin.Js.VkAuth.Step1' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = '<span class="bold">Step 1.</span> Create an application in Vkontakte.' WHERE [ResourceKey] = 'Admin.Js.VkAuth.Step1' and [LanguageId] = 2

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = '<span class="bold">Шаг 2.</span> Перейдите в Настройки созданного приложения и скопируйте "ID приложения" в магазин, вставьте в текстовое поле ниже полученный ИД приложение и нажмите на кнопку авторизоваться в Вконтакте.' WHERE [ResourceKey] = 'Admin.Js.VkAuth.Step2' and [LanguageId] = 1

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Go to the Settings of the created application and copy the "Application ID" into the store, paste the received application ID into the text field below and click on the sign in button on Vkontakte.' WHERE [ResourceKey] = 'Admin.Js.VkAuth.Step2' and [LanguageId] = 2

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Vk.Index.Title', 'Канал продаж ВКонтакте')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Vk.Index.Title', 'Sales channel Vk.com')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.VkChannel.Title', 'Канал продаж ВКонтакте')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.VkChannel.Title', 'Sales channel Vk.com')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.VkChannel.OpenGroup', 'Открыть группу ВКонтакте')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.VkChannel.OpenGroup', 'Open group')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.VkChannel.RemoveChannel', 'Отключить канал')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.VkChannel.RemoveChannel', 'Remove channel')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Telegram.Index.Title', 'Канал продаж Telegram')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Telegram.Index.Title', 'Sales channel Telegram')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Telegram.Index.RemoveChannel', 'Отключить канал')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Telegram.Index.RemoveChannel', 'Remove channel')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Instagram.Index.Title', 'Канал продаж Instagram')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Instagram.Index.Title', 'Sales channel Instagram')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Instagram.Index.RemoveChannel', 'Отключить канал')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Instagram.Index.RemoveChannel', 'Remove channel')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Template.CopyrightText', 'Copyright')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Template.CopyrightText', 'Copyright')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Template.VariableCopyrightText', 'Переменная #CURRENT_YEAR# будет заменена на текущий год')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Template.VariableCopyrightText', 'Variable #CURRENT_YEAR# will be replaced with current year')

IF Exists (SELECT 1 From [CMS].[StaticBlock] Where [Key] = 'LeftBottom' and [Content] not like '<div class="footer-copyright">Работает на AdvantShop &copy; 2018</div>%')
BEGIN
	INSERT INTO [Settings].[Settings] ([Name],[Value]) VALUES ('CopyrightText', (SELECT TOP (1) [Content] From [CMS].[StaticBlock] Where [Key] = 'LeftBottom'))
END
ELSE
BEGIN
	INSERT INTO [Settings].[Settings] ([Name],[Value]) VALUES ('CopyrightText','<div class="cs-t-3"><span>Работает на</span>&nbsp;<a href="https://www.advantshop.net?utm_source=advantshop&utm_medium=site&utm_campaign=footer" target="_blank">advantshop.net</a>&nbsp;<span>&copy; #CURRENT_YEAR#</span></div>')
END

IF Exists (SELECT 1 From [CMS].[StaticBlock] Where [Key] = 'LeftBottom')
BEGIN
	DELETE FROM [CMS].[StaticBlock] Where [Key] = 'LeftBottom'
END

GO--

CREATE TABLE [Partners].[ActReport](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[PartnerId] [int] NOT NULL,
	[FileName] [nvarchar](255) NOT NULL,
	[PeriodFrom] [datetime] NOT NULL,
	[PeriodTo] [datetime] NOT NULL,
	[DateCreated] [datetime] NOT NULL,
 CONSTRAINT [PK_ActReport] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO--

ALTER TABLE [Partners].[ActReport]  WITH CHECK ADD  CONSTRAINT [FK_ActReport_Partner] FOREIGN KEY([PartnerId])
REFERENCES [Partners].[Partner] ([Id])
ON DELETE CASCADE
GO--

DELETE FROM [CMS].[TemplatesDocx] WHERE [FileName] = 'PartnerAct_LegalEntity.docx' OR [FileName] = 'PartnerAct_NaturalPerson.docx'
GO--

INSERT INTO [Settings].[Settings] ([Name],[Value]) VALUES ('AdminAreaTemplate', 'adminv3')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Ok', 'Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Ok', 'Ok.ru')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Ok.Description', '')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Ok.Description', '')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Telegram', 'Telegram')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Telegram', 'Telegram')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.SalesChannels.SalesChannel.Telegram.Description', '')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.SalesChannels.SalesChannel.Telegram.Description', '')

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Все выгрузки' WHERE [ResourceKey] = 'Admin.ExportFeed.ComeBackToList' and [LanguageId] = 1
UPDATE [Settings].[Localization] SET [ResourceValue] = 'All exports' WHERE [ResourceKey] = 'Admin.ExportFeed.ComeBackToList' and [LanguageId] = 2

GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerLegalEntityActReport')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('Акт-отчет партнеру (для юр. лиц)', 390, 
	'Акт-отчет партнеру (для юр. лиц) (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #BALANCE#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #REWARDPERIOD#, #REWARDS_SUM#, #ACT_LINK#)', 
	'OnPartnerLegalEntityActReport')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerLegalEntityActReport'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('Акт-отчет партнеру (для юр. лиц)', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Уважаемый Партнер, #NAME#!</p>
	<p>Cформировано партнерское вознаграждение за <b>#REWARDPERIOD#</b></p>
	<p>Сумма вознаграждения: <b>#REWARDS_SUM#</b></p>
	<p>Загрузить отчет по начисленному вознаграждению вы можете, перейдя по ссылке <a href="#ACT_LINK#">#ACT_LINK#</a></p>
    <p>Перейти в личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
</div>', 1590, 1, GETDATE(), GETDATE(), 'Документы по партнерскому вознаграждению от #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerLegalEntityActReport'))
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerNaturalPersonActReport')
INSERT INTO [Settings].[MailFormatType] ([TypeName], [SortOrder], [Comment], [MailType]) 
VALUES ('Акт-отчет партнеру (для физ. лиц)', 395, 
	'Акт-отчет партнеру (для физ. лиц) (#SITEURL#, #SITENAME#, #PARTNERS_URL#, #NAME#, #EMAIL#, #PHONE#, #CITY#, #BALANCE#, #COUPONCODE#, #REWARDPERCENT#, #TYPE#, #REWARDPERIOD#, #REWARDS_SUM#, #ACT_LINK#)', 
	'OnPartnerNaturalPersonActReport')
GO--

IF NOT EXISTS(SELECT * FROM [Settings].[MailFormat] WHERE [MailFormatTypeId] = (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerNaturalPersonActReport'))
INSERT INTO [Settings].[MailFormat] ([FormatName],[FormatText],[SortOrder],[Enable],[AddDate],[ModifyDate],[FormatSubject],[MailFormatTypeId])
Values ('Акт-отчет партнеру (для физ. лиц)', '<div style="color: #4c4f56; font-family: Arial, Helvetica, sans-serif; font-size: 14px;">
    <div class="header" style="border-bottom: 1px solid #ededed; display: table; margin-bottom: 25px; padding-bottom: 25px; width: 100%;">
        <div class="logo" style="display: table-cell; text-align: left; vertical-align: middle;">#LOGO#</div>
        <div class="phone" style="display: table-cell; text-align: right; vertical-align: middle;">
            <div class="tel" style="font-size: 26px; font-weight: bold; line-height: 1; margin-bottom: 5px;">&nbsp;</div>
            <div class="inform" style="font-size: 12px;">&nbsp;</div>
        </div>
    </div>
    <p>Уважаемый Партнер, #NAME#!</p>
	<p>Cформировано партнерское вознаграждение за <b>#REWARDPERIOD#</b></p>
	<p>Сумма вознаграждения: <b>#REWARDS_SUM#</b></p>
	<p>Загрузить отчет по начисленному вознаграждению вы можете, перейдя по ссылке <a href="#ACT_LINK#">#ACT_LINK#</a></p>
    <p>Перейти в личный кабинет партнера: <a href="#PARTNERS_URL#">#PARTNERS_URL#</a></p>
</div>', 1595, 1, GETDATE(), GETDATE(), 'Документы по партнерскому вознаграждению от #SITENAME#', (SELECT TOP(1) [MailFormatTypeID] FROM [Settings].[MailFormatType] WHERE [MailType] = 'OnPartnerNaturalPersonActReport'))
GO--

IF (NOT EXISTS(SELECT * FROM [CMS].[TemplatesDocx] WHERE [FileName] = N'order-torg12.docx'))
BEGIN
	INSERT [CMS].[TemplatesDocx] ([Type], [Name], [SortOrder], [FileName], [FileSize], [DateCreated], [DateModified], [DebugMode]) VALUES (2, N'Торг-12', 0, N'order-torg12.docx', 27395, GetDate(), GetDate(), 0)
END
IF (NOT EXISTS(SELECT * FROM [CMS].[TemplatesDocx] WHERE [FileName] = N'order-utd.docx'))
BEGIN
	INSERT [CMS].[TemplatesDocx] ([Type], [Name], [SortOrder], [FileName], [FileSize], [DateCreated], [DateModified], [DebugMode]) VALUES (2, N'УПД', 0, N'order-utd.docx', 28123, GetDate(), GetDate(), 0)
END
IF (NOT EXISTS(SELECT * FROM [CMS].[TemplatesDocx] WHERE [FileName] = N'order-invoice.docx'))
BEGIN
	INSERT [CMS].[TemplatesDocx] ([Type], [Name], [SortOrder], [FileName], [FileSize], [DateCreated], [DateModified], [DebugMode]) VALUES (2, N'Счет-фактура', 0, N'order-invoice.docx', 25192, GetDate(), GetDate(), 0)
END
IF (NOT EXISTS(SELECT * FROM [CMS].[TemplatesDocx] WHERE [FileName] = N'order-check.docx'))
BEGIN
	INSERT [CMS].[TemplatesDocx] ([Type], [Name], [SortOrder], [FileName], [FileSize], [DateCreated], [DateModified], [DebugMode]) VALUES (2, N'Чек', 0, N'order-check.docx', 23984, GetDate(), GetDate(), 0)
END

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Settings.Social.SocialWidget','Социальные виджеты')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Settings.Social.SocialWidget','Social widget')

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.ExportFeeds.ResellerTitle','Реселлеры')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.ExportFeeds.ResellerTitle','Resellers')

Update [Settings].[Localization] 
Set [ResourceValue] = 'Реселлеры' 
Where [ResourceKey] = 'Admin.ExportFeeds.IndexReseller.H1' and [LanguageId] = 1

GO--
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.ShippingMethods.Sdek.AllowInspection','Осмотр вложения')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.ShippingMethods.Sdek.AllowInspection','Investment inspection')


GO--

ALTER PROCEDURE [Catalog].[sp_IncCountProductInCategory]		
	@CategoryID int,
	@client bit = 1,
	@current bit = 1
AS
BEGIN
	IF (@client = 0)
		IF (@current = 0)
			UPDATE [Catalog].[Category] 
			SET Products_Count = Products_Count + 1, Total_Products_Count = Total_Products_Count + 1, 
				Available_Products_Count = Available_Products_Count + 1 
			WHERE [CategoryID] = @CategoryID
		ELSE
			UPDATE [Catalog].[Category] 
			SET Products_Count = Products_Count + 1, Total_Products_Count = Total_Products_Count + 1, [Current_Products_Count] = [Current_Products_Count] + 1, 
				Available_Products_Count = Available_Products_Count + 1
			WHERE [CategoryID] = @CategoryID
	ELSE
		UPDATE [Catalog].[Category] SET Products_Count = Products_Count + 1 WHERE [CategoryID] = @CategoryID
	
	DECLARE @parentCategoryId int;
	SELECT @parentCategoryId = [ParentCategory] FROM [Catalog].[Category] WHERE [CategoryID] = @CategoryId
	IF(@parentCategoryId <> 0)
		EXEC [Catalog].[sp_IncCountProductInCategory] @parentCategoryId, @client, 0;
END

GO--

ALTER PROCEDURE [Catalog].[sp_DeIncCountProductInCategory]
			@CategoryID int,
			@client bit = 1,		
			@current bit = 1
AS
BEGIN
	IF (@client = 0)
		IF (@current = 0)
			UPDATE [Catalog].[Category] 
			SET Products_Count = Products_Count - 1, Total_Products_Count = Total_Products_Count - 1, 
				Available_Products_Count = Available_Products_Count - 1 
			WHERE CategoryID = @CategoryID
		ELSE
			UPDATE [Catalog].[Category] 
			SET Products_Count = Products_Count - 1, Total_Products_Count = Total_Products_Count - 1, [Current_Products_Count] = [Current_Products_Count] - 1, 
				Available_Products_Count = Available_Products_Count - 1 
			WHERE CategoryID = @CategoryID
	ELSE
		UPDATE [Catalog].[Category] SET Products_Count = Products_Count - 1 WHERE CategoryID = @CategoryID

		
		DECLARE @parentCategoryId int;
		SELECT @parentCategoryId = [ParentCategory] FROM [Catalog].[Category] WHERE [CategoryID] = @CategoryId
		IF(@parentCategoryId <> 0)
			EXEC [Catalog].[sp_DeIncCountProductInCategory] @parentCategoryId, @client, 0;
END

GO--

CREATE TABLE [Customers].[OkUser](
	[Id] [nvarchar](max) NOT NULL,
	[CustomerId] [uniqueidentifier] NOT NULL,
	[FirstName] [nvarchar](max) NULL,
	[LastName] [nvarchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO--

ALTER TABLE [Customers].[OkUser]  WITH CHECK ADD  CONSTRAINT [FK_OkUser_Customer] FOREIGN KEY([CustomerId])
REFERENCES [Customers].[Customer] ([CustomerID])
ON DELETE CASCADE

GO--

ALTER TABLE [Customers].[OkUser] CHECK CONSTRAINT [FK_OkUser_Customer]

GO--

CREATE TABLE [Customers].[OkMessage](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[MessageId] [nvarchar](max) NOT NULL,
	[ChatId] [nvarchar](max) NOT NULL,
	[UserId] [nvarchar](max) NOT NULL,
	[FromUser] [nvarchar](max) NOT NULL,
	[Text] [nvarchar](max) NULL,
	[CreatedDate] [datetime] NOT NULL
CONSTRAINT [PK_OkMessage] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO--

CREATE SCHEMA [Ok]

GO--

CREATE TABLE [Ok].[OkCatalog](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[OkCatalogId] [bigint] NOT NULL,
	[Name] [nvarchar](max) NOT NULL
 CONSTRAINT [PK_OkCatalog] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO--

CREATE TABLE [Ok].[OkCatalog_Category](
	[CategoryId] [int] NOT NULL,
	[OkCatalogId] [int] NOT NULL,
 CONSTRAINT [PK_OkCatalog_Category] PRIMARY KEY CLUSTERED 
(
	[CategoryId] ASC,
	[OkCatalogId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO--

ALTER TABLE [Ok].[OkCatalog_Category] WITH CHECK ADD CONSTRAINT [FK_OkCatalog_Category_Category] FOREIGN KEY([CategoryId])
REFERENCES [Catalog].[Category] ([CategoryID])
ON DELETE CASCADE

GO--

ALTER TABLE [Ok].[OkCatalog_Category] CHECK CONSTRAINT [FK_OkCatalog_Category_Category]

GO--

ALTER TABLE [Ok].[OkCatalog_Category] WITH CHECK ADD CONSTRAINT [FK_OkCatalog_Category_OkCatalog] FOREIGN KEY([OkCatalogId])
REFERENCES [Ok].[OkCatalog] ([Id])
ON DELETE CASCADE

GO--

ALTER TABLE [Ok].[OkCatalog_Category] CHECK CONSTRAINT [FK_OkCatalog_Category_OkCatalog]

GO--

CREATE TABLE [Ok].[OkProduct](
	[Id] [bigint] NOT NULL,
	[ProductId] [int] NOT NULL,
	[PhotoIds] [nvarchar](max) NOT NULL,
	[CatalogId] [bigint] NOT NULL,
 CONSTRAINT [PK_OkProduct] PRIMARY KEY CLUSTERED 
(
	[Id] ASC,
	[ProductId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.Crm.EMessageReplyFieldType.Ok','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.Crm.EMessageReplyFieldType.Ok','OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.Services.Crm.LeadEventType.Ok','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.Services.Crm.LeadEventType.Ok','OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Core.Orders.OrderType.Ok','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Core.Orders.OrderType.Ok','OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Leads.CustomerSocial.Ok','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Leads.CustomerSocial.Ok','OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Handlers.Leads.GetLeadEvents.OkSendedMsg','Отправленное сообщение ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Handlers.Leads.GetLeadEvents.OkSendedMsg','Sended message OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Handlers.Leads.GetLeadEvents.OkReceivedMsg','Входящее сообщение ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Handlers.Leads.GetLeadEvents.OkReceivedMsg','Received message OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Ok.Index.Title','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Ok.Index.Title','Odnoklassniki')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step1','<span class="bold">Шаг 1.</span>Зарегистрируйтесь на портале Одноклассники и привяжите к своему аккаунту email.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step1','<span class="bold">Step 1.</span>Register on the Odnoklassniki and link it to your email account.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step2','<span class="bold">Шаг 2.</span>Получите <a href="https://ok.ru/devaccess" target="_blank">права разработчика</a> и создайте свое приложение.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step2','<span class="bold">Step 2.</span>Get <a href="https://ok.ru/devaccess" target="_blank">developer access</a> and create your application.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step3','<span class="bold">Шаг 3.</span>Получить права для приложения VALUABLE_ACCESS и GROUP_CONTENT. Для запроса прав необходимо прислать id приложения и перечень нужных разрешений с описанием кейса их использования на адрес api-support@ok.ru')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step3','<span class="bold">Шаг 3.</span>Get application permissions VALUABLE_ACCESS and GROUP_CONTENT. To request rights, you must send an application id and a list of necessary permissions with a description of the case of their use to the address api-support@ok.ru')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step4','<span class="bold">Шаг 4.</span>Отметить обязательными права PHOTO_CONTENT, VALUABLE_ACCESS, GROUP_CONTENT.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step4','<span class="bold">Шаг 4.</span>Set application permissions PHOTO_CONTENT, VALUABLE_ACCESS, GROUP_CONTENT as required.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step5','<span class="bold">Шаг 5.</span>Введите данные приложения.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step5','<span class="bold">Step 5.</span>Enter application data.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.DetailedInstructions','Подробная инструкция')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.DetailedInstructions','Detailed instructions')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.ApplicationPublicKey','Публичный ключ приложения')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.ApplicationPublicKey','Application public key')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.ApplicationAccessToken','Access token приложения')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.ApplicationAccessToken','Application access token')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.ApplicationSessionSecretKey','Session secret key приложения')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.ApplicationSessionSecretKey','Application session secret key')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.Step6','<span class="bold">Шаг 6.</span>Получите токен доступа к Bot API в настройках группы.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.Step6','<span class="bold">Step 6.</span>Get access token for Bot API.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Help.HowToGetBotApi','Как получить токен Bot API в группе')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Help.HowToGetBotApi','How to get Bot API token')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.GroupSocialAccessToken','Ключ доступа группы')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.GroupSocialAccessToken','Group social access token')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkAuth.Login','Авторизоваться в ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkAuth.Login','Login')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.ExportStarted','Начался перенос товаров в OK. Длительность переноса зависит от кол-ва товаров и фотографий.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.ExportStarted','Export started. The duration of export depends on the number of products and photos.')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.ChangesSaved','Изменения сохранены')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.ChangesSaved','Changes saved')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Title','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Title','Odnoklassniki')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.OpenGroup','Открыть группу в ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.OpenGroup','Open group')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.RemoveBinding','Удалить привязку')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.RemoveBinding','Remove binding')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.RemoveChannel','Отключить канал')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.RemoveChannel','Remove channel')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Auth','Подключение группы')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Auth','Connecting group')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Export','Выгрузка товаров в ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Export','Export products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.ExportNow','Выгрузить сейчас')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.ExportNow','Export now')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Reports','Отчеты с ошибками')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Reports','Reports')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Import','Загрузка товаров из ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Import','Import products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.Crm','Работа с сообщениями')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.Crm','Working with messages')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.CrmSettings','Настройки CRM')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.CrmSettings','CRM settings')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.OkChannel.SalesFunnel','Список для лидов из Одноклассников')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.OkChannel.SalesFunnel','Leads list for OK leads')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExport.Grid.Name','Название')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExport.Grid.Name','Name')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExport.Grid.Categories','Связанные категории')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExport.Grid.Categories','Categories')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExportCtrl.Title','Свяжите категории магазина и каталоги в группе ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExportCtrl.Title','Link store categories and catalogs in the OK group')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExportCtrl.ExportSettings','Настройки выгрузки')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExportCtrl.ExportSettings','Export settings')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExportCtrl.CatalogsTitle','Каталоги товаров')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExportCtrl.CatalogsTitle','Catalogs')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketExportCtrl.AddNewCatalog','Добавить каталог')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketExportCtrl.AddNewCatalog','Add new catalog')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.TitleNew','Новый каталог')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.TitleNew','New catalog')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.TitleEdit','Редактирование каталога')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.TitleEdit','Edit catalog')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.Name','Название')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.Name','Name')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.RelatedCategories','Связанные категории')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.RelatedCategories','Related categories')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.Select','изменить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.Select','select')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.Clear','сбросить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.Clear','clear')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.Ok','Сохранить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.Ok','Save')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.addEditOkCatalog.Cancel','Отменить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.addEditOkCatalog.Cancel','Cancel')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.Title','Парметры выгрузки товаров')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.Title','Export settings')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.Currency','Валюта')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.Currency','Currency')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite','Добавлять ссылку на сайт')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite','Export link to site')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.No','Нет')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.No','No')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.Top','Сверху')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.Top','Top')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.Bottom','Снизу')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportLinkToSite.Bottom','Bottom')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportDescription','Выгружать описание')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportDescription','Export description')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportDescription.No','Нет')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportDescription.No','No')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportDescription.Full','Полное')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportDescription.Full','Full')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportDescription.Short','Краткое')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportDescription.Short','Short')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportUnavailableProducts','Выгружать недоступные товары')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportUnavailableProducts','Export гnavailable products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportProductsProperties','Выгружать свойства товара')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportProductsProperties','Export products properties')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportSizeAndColorInName','Добавлять размер и цвет в название')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportSizeAndColorInName','Export size and color in name')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportSizeAndColorInDescription','Добавлять размер и цвет в описание товара')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportSizeAndColorInDescription','Export size and color in description')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportUpdateProductPhotos','Обновлять фотографии')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportUpdateProductPhotos','Update product photos')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportTitle','Выгрузка')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportTitle','Export')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.ExportOnShedule','Выгружать по расписанию')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.ExportOnShedule','Export on shedule')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.Save','Сохранить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.Save','Save')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.saveOkMarketExportSettings.Cancel','Отменить')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.saveOkMarketExportSettings.Cancel','Cancel')

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketImport.Title','Импорт товаров и категорий из ОК')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketImport.Title','Import products and categories from OK')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketImport.Import','Импортировать')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketImport.Import','Import')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.okMarketImport.Reports','Отчеты с ошибками')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.okMarketImport.Reports','Reports')

GO--

UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Триггерный маркетинг помогает зарабатывать вам больше с каждого вашего клиента. Взаимодействуйте с покупателем до и после покупки и получайте больше заказов. Сегментируйте базу клиентов и настраивайте автоматические рассылки по событиям.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.Triggers.Description' AND [LanguageId]=1
 
 UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Яндекс.Маркет - крупная торговая площадка России в формате товарного агрегатора, обладает большой аудиторией покупателей. Настройте процесс обмена каталогом товаров с этой товарной площадкой и получайте новых клиентов.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.YandexMarket.Description' AND [LanguageId]=1
 
UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Сервис Google Merchant Center позволяет загружать данные о ваших товарах, чтобы ваши потенциальные клиенты увидели их в результатах поиска Google.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.GoogleMerchantCenter.Description' AND [LanguageId]=1
 
UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Авито - интернет-сервис для размещения объявлений о товарах. Выгружайте автоматически ваши товары в Авито и развивайте новый канал продаж.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.Avito.Description' AND [LanguageId]=1
   
 UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Товары ВКонтакте – это витрина с товарами в вашем сообществе или приложении в социальной сети. Выгружайте ваши товары в магазин ВКонтакте и привлекайте новых покупателей.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.VKontakte.Description' AND [LanguageId]=1
 
 UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Магазин на Одноклассниках - это витрина с товарами вашего интернет-магазина в группе социальной сети. Выгружайте товары в магазин на Одноклассниках, продвигайте их и принимайте заказы через сообщения прямо  внутри ADVANTSHOP.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.Ok.Description' AND [LanguageId]=1
 
 UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Используйте Instagram - одну из самых популярных социальных сетей в мире, и привлекайте больше потенциальных клиентов. Переведите общение с покупателями из директа и комментариев в админку ADVANTSHOP и фиксируйте все заявки в одном месте.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.Instagram.Description' AND [LanguageId]=1 
 
UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Продавайте в Telegram. Ловите клиентов из Telegram и общайтесь с ним прямо в CRM интернет-магазина.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.Telegram.Description' AND [LanguageId]=1 
 
UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Создавайте виртуальные бонусные карты, начисляйте бонусы при покупке, удерживайте и возвращайте покупателя.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.BonusProgram.Description' AND [LanguageId]=1 
 
 UPDATE [Settings].[Localization]
   SET [ResourceValue] = 'Продавайте через партнеров. Cоздавайте партнерскую программу для увеличения ваших продаж, запускайте различные кампании для ваших партнеров.'
 WHERE [ResourceKey] = 'Core.SalesChannels.SalesChannel.AffiliateProgram.Description' AND [LanguageId]=1 
 
 GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Import','Импорт данных')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Import','Import data')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Import.Products','Товары')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Import.Products','Products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Import.Categories','Категории')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Import.Categories','Categories')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Export','Экспорт данных')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Export','Export data')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Export.Description','Выгрузка данных в CSV формат')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Export.Description','Export data to CSV format')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Export.Products','Товары')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Export.Products','Products')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Catalog.Export.Categories','Категории')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Catalog.Export.Categories','Categories')

GO--

UPDATE [Settings].[Localization] 
   SET [ResourceValue] = 'Параметры магазина' 
 WHERE [ResourceKey] = 'Admin.Settings.Template.Title' AND [LanguageId] = 1 

UPDATE [Settings].[Localization] 
   SET [ResourceValue] = 'Параметры магазина' 
 WHERE [ResourceKey] = 'Admin.Design.Index.TemplateSettings' AND [LanguageId] = 1 
 
GO--


INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.CommonStatistic.AlreadyRunning','Уже запущена другая фоновая задача <a href="{0}">{1}</a>')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.CommonStatistic.AlreadyRunning','Another task already running <a href="{0}">{1}</a>')
GO--


ALTER TABLE Settings.Redirect
ADD Created dateTime
 
GO--

UPDATE [Settings].[Redirect]
   SET [Created] = SYSDATETIME()
 WHERE Created is null

ALTER TABLE Settings.Redirect
ALTER COLUMN Created dateTime NOT NULL
 
GO--

ALTER TABLE Settings.Redirect
ADD Edited dateTime
 
GO--

UPDATE [Settings].[Redirect]
   SET [Edited] = SYSDATETIME()
 WHERE Edited is null

ALTER TABLE Settings.Redirect
ALTER COLUMN Edited dateTime NOT NULL
 
GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.SettingsSeo.Created','Дата добавления')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.SettingsSeo.Created','Date added')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.SettingsSeo.Edited','Дата изменения')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.SettingsSeo.Edited','Date edited')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Import301Red.Import','Импорт данных')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Import301Red.Import','Import redirects')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Import301Red.Cancel','Отмена')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Import301Red.Cancel','Cancel')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Js.Import301Red.Success','Данные успешно импортированы')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Js.Import301Red.Success','Data successfully uploaded')

GO--

If not Exists(Select 1 From sys.columns WHERE Name = N'AnalyticsAccessForAll' AND Object_ID = Object_ID(N'Booking.Affiliate'))
Begin
	ALTER TABLE Booking.Affiliate ADD
		AnalyticsAccessForAll bit NULL
end

GO--

If Exists(Select 1 From sys.columns WHERE Name = N'AnalyticsAccessForAll' AND Object_ID = Object_ID(N'Booking.Affiliate'))
Begin
	UPDATE Booking.Affiliate SET AnalyticsAccessForAll = 1 WHERE AnalyticsAccessForAll IS NULL
end

GO--

ALTER TABLE Booking.Affiliate ALTER COLUMN
	AnalyticsAccessForAll bit NOT NULL

GO--

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[Booking].[AffiliateAnalyticManager]') AND type in (N'U'))
BEGIN
CREATE TABLE [Booking].[AffiliateAnalyticManager](
	[AffiliateId] [int] NOT NULL,
	[ManagerId] [int] NOT NULL,
 CONSTRAINT [PK_AffiliateAnalyticManager] PRIMARY KEY CLUSTERED 
(
	[AffiliateId] ASC,
	[ManagerId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
END

GO--

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[Booking].[FK_AffiliateAnalyticManager_Affiliate]') AND parent_object_id = OBJECT_ID(N'[Booking].[AffiliateAnalyticManager]'))
ALTER TABLE [Booking].[AffiliateAnalyticManager]  WITH CHECK ADD  CONSTRAINT [FK_AffiliateAnalyticManager_Affiliate] FOREIGN KEY([AffiliateId])
REFERENCES [Booking].[Affiliate] ([Id])
ON DELETE CASCADE

GO--

IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[Booking].[FK_AffiliateAnalyticManager_Affiliate]') AND parent_object_id = OBJECT_ID(N'[Booking].[AffiliateAnalyticManager]'))
ALTER TABLE [Booking].[AffiliateAnalyticManager] CHECK CONSTRAINT [FK_AffiliateAnalyticManager_Affiliate]

GO--

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[Booking].[FK_AffiliateAnalyticManager_Managers]') AND parent_object_id = OBJECT_ID(N'[Booking].[AffiliateAnalyticManager]'))
ALTER TABLE [Booking].[AffiliateAnalyticManager]  WITH CHECK ADD  CONSTRAINT [FK_AffiliateAnalyticManager_Managers] FOREIGN KEY([ManagerId])
REFERENCES [Customers].[Managers] ([ManagerId])
ON DELETE CASCADE

GO--

IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[Booking].[FK_AffiliateAnalyticManager_Managers]') AND parent_object_id = OBJECT_ID(N'[Booking].[AffiliateAnalyticManager]'))
ALTER TABLE [Booking].[AffiliateAnalyticManager] CHECK CONSTRAINT [FK_AffiliateAnalyticManager_Managers]

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Налог' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Admin.Js.CertificateSettings.Taxes'
UPDATE [Settings].[Localization] SET [ResourceValue] = 'Tax' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Admin.Js.CertificateSettings.Taxes'

GO--

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Многофункциональнй интернет-магазин, предназначен для продажи большого количества товаров. Если у вас более 3х категорий товаров, и более 50-100 товаров, то вам нужен полноценный Интернет-магазин.' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.OnlineStore.Description'

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Multifunctional online store designed to sell large quantities of goods. If you have more than 3 categories of goods, and more than 50-100 products, then you need a full-fledged online store.' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.OnlineStore.Description'


UPDATE [Settings].[Localization] SET [ResourceValue] = 'Воронка продаж - это последовательность страниц, предназначеных для продажи узкого ассортимента товаров. Повышайте конверсию в продажу, поэтапно выстраивая отношения с клиентами. Каждое действие в воронке увеличивает вероятность покупки. Всего представлено 16 типов воронок продаж.' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.SalesFunnels.Description'

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Воронка продаж - это последовательность страниц, предназначеных для продажи узкого ассортимента товаров. Повышайте конверсию в продажу, поэтапно выстраивая отношения с клиентами. Каждое действие в воронке увеличивает вероятность покупки. Всего представлено 16 типов воронок продаж.' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.SalesFunnels.Description'

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Воронки продаж' WHERE [LanguageId] = '1' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.SalesFunnels'

UPDATE [Settings].[Localization] SET [ResourceValue] = 'Sales funnels' WHERE [LanguageId] = '2' AND [ResourceKey] = 'Core.SalesChannels.SalesChannel.SalesFunnels'

GO--

If not Exists (Select 1 From [Settings].[Localization] Where [ResourceKey] = 'Js.CartPopup.Continue')
Begin
	INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Js.CartPopup.Continue', 'Продолжить покупки')
	INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Js.CartPopup.Continue', 'Continue shopping')
End

If not Exists (Select 1 From [Settings].[Localization] Where [ResourceKey] = 'Js.CartPopup.Checkout')
Begin
	INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Js.CartPopup.Checkout', 'Оформить заказ')
	INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Js.CartPopup.Checkout', 'Checkout')
End

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Common.TopMenu.DomainsManagment','Управление доменами')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Common.TopMenu.DomainsManagment','Domains managment')

GO--

ALTER TABLE [Order].[StatusHistory] 
ALTER COLUMN [Basis] nvarchar(MAX) NOT NULL

GO--

if not exists (select value from [Settings].[Settings] where name = 'NewsMainMetaKeywords')
	insert into [Settings].[Settings] (name, value) values ('NewsMainMetaKeywords', '#STORE_NAME# - #NEWSCATEGORY_NAME#')
  
if not exists( select value from [Settings].[Settings] where name = 'NewsMainMetaDescription')
	insert into [Settings].[Settings] (name, value) values ('NewsMainMetaDescription', '#STORE_NAME# - #NEWSCATEGORY_NAME#')


if not exists (select value from [Settings].[Settings] where name = 'TagH1')
	insert into [Settings].[Settings] (name, value) values ('TagH1', '#TAG_NAME#')
  
if not exists( select value from [Settings].[Settings] where name = 'TagTitle')
	insert into [Settings].[Settings] (name, value) values ('TagTitle', '#STORE_NAME# - #TAG_NAME#')

if not exists (select value from [Settings].[Settings] where name = 'TagMetaKeywords')
	insert into [Settings].[Settings] (name, value) values ('TagMetaKeywords', '#STORE_NAME# - #TAG_NAME#')
  
if not exists( select value from [Settings].[Settings] where name = 'TagMetaDescription')
	insert into [Settings].[Settings] (name, value) values ('TagMetaDescription', '#STORE_NAME# - #TAG_NAME#')


if (select value from [Settings].[Settings]  where name = 'NewsMainTitle') = 'Новости - #STORE_NAME#'
	update [Settings].[Settings]  set value = '#STORE_NAME# - #NEWSCATEGORY_NAME#' where name='NewsMainTitle'

if (select value from [Settings].[Settings]  where name = 'NewsMainH1') = 'Новости'
	update [Settings].[Settings]  set value = '#NEWSCATEGORY_NAME#'  where name = 'NewsMainH1'

GO--

INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (1,'Admin.Customers.ViewSocial.Odnoklassniki','Одноклассники')
INSERT INTO [Settings].[Localization] ([LanguageId],[ResourceKey],[ResourceValue]) VALUES (2,'Admin.Customers.ViewSocial.Odnoklassniki','Odnoklassniki')

GO--

UPDATE [Settings].[InternalSettings] SET [settingValue] = '8.0.0' WHERE [settingKey] = 'db_version'
